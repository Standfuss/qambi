(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.qambi = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
var saveAs=saveAs||function(e){"use strict";if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var t=e.document,n=function(){return e.URL||e.webkitURL||e},o=t.createElementNS("http://www.w3.org/1999/xhtml","a"),r="download"in o,i=function(e){var t=new MouseEvent("click");e.dispatchEvent(t)},a=/Version\/[\d\.]+.*Safari/.test(navigator.userAgent),c=e.webkitRequestFileSystem,f=e.requestFileSystem||c||e.mozRequestFileSystem,d=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},u="application/octet-stream",s=0,l=4e4,v=function(e){var t=function(){"string"==typeof e?n().revokeObjectURL(e):e.remove()};setTimeout(t,l)},p=function(e,t,n){t=[].concat(t);for(var o=t.length;o--;){var r=e["on"+t[o]];if("function"==typeof r)try{r.call(e,n||e)}catch(i){d(i)}}},w=function(e){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e},y=function(t,d,l){l||(t=w(t));var y,m,S,h=this,R=t.type,O=!1,g=function(){p(h,"writestart progress write writeend".split(" "))},b=function(){if(m&&a&&"undefined"!=typeof FileReader){var o=new FileReader;return o.onloadend=function(){var e=o.result;m.location.href="data:attachment/file"+e.slice(e.search(/[,;]/)),h.readyState=h.DONE,g()},o.readAsDataURL(t),void(h.readyState=h.INIT)}if(!O&&y||(y=n().createObjectURL(t)),m)m.location.href=y;else{var r=e.open(y,"_blank");void 0===r&&a&&(e.location.href=y)}h.readyState=h.DONE,g(),v(y)},E=function(e){return function(){return h.readyState!==h.DONE?e.apply(this,arguments):void 0}},N={create:!0,exclusive:!1};return h.readyState=h.INIT,d||(d="download"),r?(y=n().createObjectURL(t),void setTimeout(function(){o.href=y,o.download=d,i(o),g(),v(y),h.readyState=h.DONE})):(e.chrome&&R&&R!==u&&(S=t.slice||t.webkitSlice,t=S.call(t,0,t.size,u),O=!0),c&&"download"!==d&&(d+=".download"),(R===u||c)&&(m=e),f?(s+=t.size,void f(e.TEMPORARY,s,E(function(e){e.root.getDirectory("saved",N,E(function(e){var n=function(){e.getFile(d,N,E(function(e){e.createWriter(E(function(n){n.onwriteend=function(t){m.location.href=e.toURL(),h.readyState=h.DONE,p(h,"writeend",t),v(e)},n.onerror=function(){var e=n.error;e.code!==e.ABORT_ERR&&b()},"writestart progress write abort".split(" ").forEach(function(e){n["on"+e]=h["on"+e]}),n.write(t),h.abort=function(){n.abort(),h.readyState=h.DONE},h.readyState=h.WRITING}),b)}),b)};e.getFile(d,{create:!1},E(function(e){e.remove(),n()}),E(function(e){e.code===e.NOT_FOUND_ERR?n():b()}))}),b)}),b)):void b())},m=y.prototype,S=function(e,t,n){return new y(e,t,n)};return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(e,t,n){return n||(e=w(e)),navigator.msSaveOrOpenBlob(e,t||"download")}:(m.abort=function(){var e=this;e.readyState=e.DONE,p(e,"abort")},m.readyState=m.INIT=0,m.WRITING=1,m.DONE=2,m.error=m.onwritestart=m.onprogress=m.onwrite=m.onabort=m.onerror=m.onwriteend=null,S)}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);"undefined"!=typeof module&&module.exports?module.exports.saveAs=saveAs:"undefined"!=typeof define&&null!==define&&null!==define.amd&&define([],function(){return saveAs});
},{}],2:[function(require,module,exports){
require("whatwg-fetch"),module.exports=self.fetch.bind(self);
},{"whatwg-fetch":3}],3:[function(require,module,exports){
!function(t){"use strict";function e(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function r(t){return"string"!=typeof t&&(t=String(t)),t}function o(t){var e={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return y.iterable&&(e[Symbol.iterator]=function(){return e}),e}function n(t){this.map={},t instanceof n?t.forEach(function(t,e){this.append(e,t)},this):t&&Object.getOwnPropertyNames(t).forEach(function(e){this.append(e,t[e])},this)}function s(t){return t.bodyUsed?Promise.reject(new TypeError("Already read")):void(t.bodyUsed=!0)}function i(t){return new Promise(function(e,r){t.onload=function(){e(t.result)},t.onerror=function(){r(t.error)}})}function a(t){var e=new FileReader;return e.readAsArrayBuffer(t),i(e)}function h(t){var e=new FileReader;return e.readAsText(t),i(e)}function u(){return this.bodyUsed=!1,this._initBody=function(t){if(this._bodyInit=t,"string"==typeof t)this._bodyText=t;else if(y.blob&&Blob.prototype.isPrototypeOf(t))this._bodyBlob=t;else if(y.formData&&FormData.prototype.isPrototypeOf(t))this._bodyFormData=t;else if(y.searchParams&&URLSearchParams.prototype.isPrototypeOf(t))this._bodyText=t.toString();else if(t){if(!y.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(t))throw new Error("unsupported BodyInit type")}else this._bodyText="";this.headers.get("content-type")||("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):y.searchParams&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},y.blob?(this.blob=function(){var t=s(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this.blob().then(a)},this.text=function(){var t=s(this);if(t)return t;if(this._bodyBlob)return h(this._bodyBlob);if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)}):this.text=function(){var t=s(this);return t?t:Promise.resolve(this._bodyText)},y.formData&&(this.formData=function(){return this.text().then(p)}),this.json=function(){return this.text().then(JSON.parse)},this}function f(t){var e=t.toUpperCase();return b.indexOf(e)>-1?e:t}function d(t,e){e=e||{};var r=e.body;if(d.prototype.isPrototypeOf(t)){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new n(t.headers)),this.method=t.method,this.mode=t.mode,r||(r=t._bodyInit,t.bodyUsed=!0)}else this.url=t;if(this.credentials=e.credentials||this.credentials||"omit",!e.headers&&this.headers||(this.headers=new n(e.headers)),this.method=f(e.method||this.method||"GET"),this.mode=e.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&r)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(r)}function p(t){var e=new FormData;return t.trim().split("&").forEach(function(t){if(t){var r=t.split("="),o=r.shift().replace(/\+/g," "),n=r.join("=").replace(/\+/g," ");e.append(decodeURIComponent(o),decodeURIComponent(n))}}),e}function c(t){var e=new n,r=(t.getAllResponseHeaders()||"").trim().split("\n");return r.forEach(function(t){var r=t.trim().split(":"),o=r.shift().trim(),n=r.join(":").trim();e.append(o,n)}),e}function l(t,e){e||(e={}),this.type="default",this.status=e.status,this.ok=this.status>=200&&this.status<300,this.statusText=e.statusText,this.headers=e.headers instanceof n?e.headers:new n(e.headers),this.url=e.url||"",this._initBody(t)}if(!t.fetch){var y={searchParams:"URLSearchParams"in t,iterable:"Symbol"in t&&"iterator"in Symbol,blob:"FileReader"in t&&"Blob"in t&&function(){try{return new Blob,!0}catch(t){return!1}}(),formData:"FormData"in t,arrayBuffer:"ArrayBuffer"in t};n.prototype.append=function(t,o){t=e(t),o=r(o);var n=this.map[t];n||(n=[],this.map[t]=n),n.push(o)},n.prototype["delete"]=function(t){delete this.map[e(t)]},n.prototype.get=function(t){var r=this.map[e(t)];return r?r[0]:null},n.prototype.getAll=function(t){return this.map[e(t)]||[]},n.prototype.has=function(t){return this.map.hasOwnProperty(e(t))},n.prototype.set=function(t,o){this.map[e(t)]=[r(o)]},n.prototype.forEach=function(t,e){Object.getOwnPropertyNames(this.map).forEach(function(r){this.map[r].forEach(function(o){t.call(e,o,r,this)},this)},this)},n.prototype.keys=function(){var t=[];return this.forEach(function(e,r){t.push(r)}),o(t)},n.prototype.values=function(){var t=[];return this.forEach(function(e){t.push(e)}),o(t)},n.prototype.entries=function(){var t=[];return this.forEach(function(e,r){t.push([r,e])}),o(t)},y.iterable&&(n.prototype[Symbol.iterator]=n.prototype.entries);var b=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];d.prototype.clone=function(){return new d(this)},u.call(d.prototype),u.call(l.prototype),l.prototype.clone=function(){return new l(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new n(this.headers),url:this.url})},l.error=function(){var t=new l(null,{status:0,statusText:""});return t.type="error",t};var m=[301,302,303,307,308];l.redirect=function(t,e){if(-1===m.indexOf(e))throw new RangeError("Invalid status code");return new l(null,{status:e,headers:{location:t}})},t.Headers=n,t.Request=d,t.Response=l,t.fetch=function(t,e){return new Promise(function(r,o){function n(){return"responseURL"in i?i.responseURL:/^X-Request-URL:/m.test(i.getAllResponseHeaders())?i.getResponseHeader("X-Request-URL"):void 0}var s;s=d.prototype.isPrototypeOf(t)&&!e?t:new d(t,e);var i=new XMLHttpRequest;i.onload=function(){var t={status:i.status,statusText:i.statusText,headers:c(i),url:n()},e="response"in i?i.response:i.responseText;r(new l(e,t))},i.onerror=function(){o(new TypeError("Network request failed"))},i.ontimeout=function(){o(new TypeError("Network request failed"))},i.open(s.method,s.url,!0),"include"===s.credentials&&(i.withCredentials=!0),"responseType"in i&&y.blob&&(i.responseType="blob"),s.headers.forEach(function(t,e){i.setRequestHeader(e,t)}),i.send("undefined"==typeof s._bodyInit?null:s._bodyInit)})},t.fetch.polyfill=!0}}("undefined"!=typeof self?self:this);
},{}],4:[function(require,module,exports){
!function(e,t){if("function"==typeof define&&define.amd)define(["exports"],t);else if("undefined"!=typeof exports)t(exports);else{var r={exports:{}};t(r.exports),e.constants=r.exports}}(this,function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var t={};Object.defineProperty(t,"NOTE_OFF",{value:128}),Object.defineProperty(t,"NOTE_ON",{value:144}),Object.defineProperty(t,"POLY_PRESSURE",{value:160}),Object.defineProperty(t,"CONTROL_CHANGE",{value:176}),Object.defineProperty(t,"PROGRAM_CHANGE",{value:192}),Object.defineProperty(t,"CHANNEL_PRESSURE",{value:208}),Object.defineProperty(t,"PITCH_BEND",{value:224}),Object.defineProperty(t,"SYSTEM_EXCLUSIVE",{value:240}),Object.defineProperty(t,"MIDI_TIMECODE",{value:241}),Object.defineProperty(t,"SONG_POSITION",{value:242}),Object.defineProperty(t,"SONG_SELECT",{value:243}),Object.defineProperty(t,"TUNE_REQUEST",{value:246}),Object.defineProperty(t,"EOX",{value:247}),Object.defineProperty(t,"TIMING_CLOCK",{value:248}),Object.defineProperty(t,"START",{value:250}),Object.defineProperty(t,"CONTINUE",{value:251}),Object.defineProperty(t,"STOP",{value:252}),Object.defineProperty(t,"ACTIVE_SENSING",{value:254}),Object.defineProperty(t,"SYSTEM_RESET",{value:255}),Object.defineProperty(t,"TEMPO",{value:81}),Object.defineProperty(t,"TIME_SIGNATURE",{value:88}),Object.defineProperty(t,"END_OF_TRACK",{value:47}),e.MIDIEventTypes=t});
},{}],5:[function(require,module,exports){
!function(e,t){if("function"==typeof define&&define.amd)define(["exports"],t);else if("undefined"!=typeof exports)t(exports);else{var r={exports:{}};t(r.exports),e.eventlistener=r.exports}}(this,function(e){"use strict";function t(e){var t=void 0;if("event"===e.type){var r=e.data,n=r.type;if(i.has(n)){t=i.get(n);var o=!0,a=!1,l=void 0;try{for(var f,v=t.values()[Symbol.iterator]();!(o=(f=v.next()).done);o=!0){var s=f.value;s(r)}}catch(u){a=!0,l=u}finally{try{!o&&v["return"]&&v["return"]()}finally{if(a)throw l}}}}if(i.has(e.type)!==!1){t=i.get(e.type);var y=!0,c=!1,d=void 0;try{for(var p,h=t.values()[Symbol.iterator]();!(y=(p=h.next()).done);y=!0){var g=p.value;g(e)}}catch(u){c=!0,d=u}finally{try{!y&&h["return"]&&h["return"]()}finally{if(c)throw d}}}}function r(e,t){var r=void 0,n=e+"_"+(new Date).getTime();return i.has(e)===!1?(r=new Map,i.set(e,r)):r=i.get(e),r.set(n,t),n}function n(e,t){if(i.has(e)===!1)return void console.log("no eventlisteners of type"+e);var r=i.get(e);if("function"==typeof t){var n=!0,a=!1,l=void 0;try{for(var f,v=r.entries()[Symbol.iterator]();!(n=(f=v.next()).done);n=!0){var s=o(f.value,2),u=s[0],y=s[1];if(console.log(u,y),y===t){console.log(u),t=u;break}}}catch(c){a=!0,l=c}finally{try{!n&&v["return"]&&v["return"]()}finally{if(a)throw l}}"string"==typeof t&&r["delete"](t)}else"string"==typeof t?r["delete"](t):console.log("could not remove eventlistener")}Object.defineProperty(e,"__esModule",{value:!0}),e.dispatchEvent=t,e.addEventListener=r,e.removeEventListener=n;var o=function(){function e(e,t){var r=[],n=!0,o=!1,i=void 0;try{for(var a,l=e[Symbol.iterator]();!(n=(a=l.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(f){o=!0,i=f}finally{try{!n&&l["return"]&&l["return"]()}finally{if(o)throw i}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=new Map});
},{}],6:[function(require,module,exports){
!function(e,t){if("function"==typeof define&&define.amd)define(["exports"],t);else if("undefined"!=typeof exports)t(exports);else{var n={exports:{}};t(n.exports),e.fetch_helpers=n.exports}}(this,function(e){"use strict";function t(e){return e.status>=200&&e.status<300?Promise.resolve(e):Promise.reject(new Error(e.statusText))}function n(e){return e.json()}function r(e){return e.arrayBuffer()}function f(e){return new Promise(function(r,f){fetch(e).then(t).then(n).then(function(e){r(e)})["catch"](function(e){f(e)})})}function o(e){return new Promise(function(n,f){fetch(e).then(t).then(r).then(function(e){n(e)})["catch"](function(e){f(e)})})}Object.defineProperty(e,"__esModule",{value:!0}),e.status=t,e.json=n,e.arrayBuffer=r,e.fetchJSON=f,e.fetchArraybuffer=o});
},{}],7:[function(require,module,exports){
!function(e,i){if("function"==typeof define&&define.amd)define(["exports","./qambi","./song","./sampler","./init_audio","./init_midi"],i);else if("undefined"!=typeof exports)i(exports,require("./qambi"),require("./song"),require("./sampler"),require("./init_audio"),require("./init_midi"));else{var n={exports:{}};i(n.exports,e.qambi,e.song,e.sampler,e.init_audio,e.init_midi),e.init=n.exports}}(this,function(e,i,n,t,o,r){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}function u(e){var i=new t.Sampler;return new Promise(function(n,t){i.parseSampleData(e).then(function(){return n(i)})})}function s(){var e=arguments.length<=0||void 0===arguments[0]?null:arguments[0],i=[(0,o.initAudio)(),(0,r.initMIDI)()],t=void 0;if(null!==e){t=Object.keys(e);var a=!0,s=!1,d=void 0;try{for(var f,m=t[Symbol.iterator]();!(a=(f=m.next()).done);a=!0){var c=f.value,v=e[c];"Song"===v.type?i.push(n.Song.fromMIDIFile(v.url)):"Instrument"===v.type&&i.push(u(v))}}catch(g){s=!0,d=g}finally{try{!a&&m["return"]&&m["return"]()}finally{if(s)throw d}}}return new Promise(function(e,n){Promise.all(i).then(function(i){var n={};i.forEach(function(e,o){0===o?(n.legacy=e.legacy,n.mp3=e.mp3,n.ogg=e.ogg):1===o?(n.midi=e.midi,n.webmidi=e.webmidi):i[t[o-2]]=e}),console.log("qambi",l["default"].version),e(i)},function(e){n(e)})})}Object.defineProperty(e,"__esModule",{value:!0}),e.Blob=e.rAF=e.getUserMedia=void 0,e.init=s;var l=a(i);e.getUserMedia=function(){return"undefined"!=typeof navigator?navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia:function(){console.warn("getUserMedia is not available")}}(),e.rAF=function(){return"undefined"!=typeof navigator?window.requestAnimationFrame||window.webkitRequestAnimationFrame:function(){console.warn("requestAnimationFrame is not available")}}(),e.Blob=function(){return"undefined"!=typeof navigator?window.Blob||window.webkitBlob:function(){console.warn("Blob is not available")}}()});
},{"./init_audio":8,"./init_midi":9,"./qambi":22,"./sampler":26,"./song":32}],8:[function(require,module,exports){
!function(e,n){if("function"==typeof define&&define.amd)define(["exports","./samples","./parse_audio"],n);else if("undefined"!=typeof exports)n(exports,require("./samples"),require("./parse_audio"));else{var o={exports:{}};n(o.exports,e.samples,e.parse_audio),e.init_audio=o.exports}}(this,function(e,n,o){"use strict";function t(e){return e&&e.__esModule?e:{"default":e}}function i(){"undefined"==typeof l.createGainNode&&(l.createGainNode=l.createGain),c={};var n=l.createBufferSource();return c.legacy=!1,"undefined"==typeof n.start&&(c.legacy=!0),e.masterCompressor=d=l.createDynamicsCompressor(),d.connect(l.destination),e.masterGain=u=l.createGain(),u.connect(l.destination),u.gain.value=.5,f=!0,new Promise(function(e,n){(0,o.parseSamples)(a["default"]).then(function(o){c.ogg="undefined"!=typeof o.emptyOgg,c.mp3="undefined"!=typeof o.emptyMp3,c.lowtick=o.lowtick,c.hightick=o.hightick,c.ogg===!1&&c.mp3===!1?n("No support for ogg nor mp3!"):e(c)},function(){n("Something went wrong while initializing Audio")})})}function r(){return c}Object.defineProperty(e,"__esModule",{value:!0}),e.configureMasterCompressor=e.enableMasterCompressor=e.getCompressionReduction=e.getMasterVolume=e.setMasterVolume=e.masterCompressor=e.unlockWebAudio=e.masterGain=e.context=void 0,e.initAudio=i,e.getInitData=r;var a=t(n),s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},c=void 0,u=void 0,d=void 0,f=!1,l=e.context=function(){var n=void 0;if("object"===("undefined"==typeof window?"undefined":s(window))){var o=window.AudioContext||window.webkitAudioContext;"undefined"!==o&&(n=new o)}return"undefined"==typeof n&&(e.context=l={createGain:function(){return{gain:1}},createOscillator:function(){}}),n}(),p=function(){var n=arguments.length<=0||void 0===arguments[0]?.5:arguments[0];f===!1?console.warn("please call qambi.init() first"):(e.setMasterVolume=p=function(){var e=arguments.length<=0||void 0===arguments[0]?.5:arguments[0];e>1&&console.info("maximal volume is 1.0, volume is set to 1.0"),e=0>e?0:e>1?1:e,u.gain.value=e},p(n))},m=function(){return f!==!1?(e.getMasterVolume=m=function(){return u.gain.value},m()):void console.warn("please call qambi.init() first")},v=function(){return f!==!1?(e.getCompressionReduction=v=function(){return d.reduction.value},v()):void console.warn("please call qambi.init() first")},g=function(){f===!1?console.warn("please call qambi.init() first"):(e.enableMasterCompressor=g=function(e){e?(u.disconnect(0),u.connect(d),d.disconnect(0),d.connect(l.destination)):(d.disconnect(0),u.disconnect(0),u.connect(l.destination))},g())},y=function(n){f===!1?console.warn("please call qambi.init() first"):(e.configureMasterCompressor=y=function(e){var n=e.attack;d.attack=void 0===n?.003:n;var o=e.knee;d.knee=void 0===o?30:o;var t=e.ratio;d.ratio=void 0===t?12:t;var i=e.reduction;d.reduction=void 0===i?0:i;var r=e.release;d.release=void 0===r?.25:r;var a=e.threshold;d.threshold=void 0===a?-24:a},y(n))},w=function(){var n=l.createOscillator(),o=l.createGain();o.gain.value=0,n.connect(o),o.connect(l.destination),"undefined"!=typeof n.noteOn&&(n.start=n.noteOn,n.stop=n.noteOff),n.start(0),n.stop(.001),e.unlockWebAudio=w=function(){}};e.masterGain=u,e.unlockWebAudio=w,e.masterCompressor=d,e.setMasterVolume=p,e.getMasterVolume=m,e.getCompressionReduction=v,e.enableMasterCompressor=g,e.configureMasterCompressor=y});
},{"./parse_audio":17,"./samples":27}],9:[function(require,module,exports){
!function(t,e){if("function"==typeof define&&define.amd)define(["exports","./util"],e);else if("undefined"!=typeof exports)e(exports,require("./util"));else{var n={exports:{}};e(n.exports,t.util),t.init_midi=n.exports}}(this,function(t,e){"use strict";function n(){u=Array.from(r.inputs.values()),u.sort(function(t,e){return t.name.toLowerCase()<=e.name.toLowerCase()?1:-1});var t=!0,e=!1,n=void 0;try{for(var i,o=u[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var l=i.value;c.set(l.id,l),a.push(l.id)}}catch(d){e=!0,n=d}finally{try{!t&&o["return"]&&o["return"]()}finally{if(e)throw n}}s=Array.from(r.outputs.values()),s.sort(function(t,e){return t.name.toLowerCase()<=e.name.toLowerCase()?1:-1});var p=!0,v=!1,g=void 0;try{for(var M,y=s[Symbol.iterator]();!(p=(M=y.next()).done);p=!0){var D=M.value;f.set(D.id,D),I.push(D.id)}}catch(d){v=!0,g=d}finally{try{!p&&y["return"]&&y["return"]()}finally{if(v)throw g}}}function i(){return new Promise(function(t,e){"undefined"==typeof navigator?(o=!0,t({midi:!1})):"undefined"!=typeof navigator.requestMIDIAccess?!function(){var i=void 0,a=void 0,I=void 0;navigator.requestMIDIAccess().then(function(e){r=e,"undefined"!=typeof e._jazzInstances?(i=e._jazzInstances[0]._Jazz.version,a=!0):(I=!0,a=!0),n(),e.onconnect=function(t){console.log("device connected",t),n()},e.ondisconnect=function(t){console.log("device disconnected",t),n()},o=!0,t({jazz:i,midi:a,webmidi:I,inputs:u,outputs:s,inputsById:c,outputsById:f})},function(t){e("Something went wrong while requesting MIDIAccess",t)})}():(o=!0,t({midi:!1}))})}Object.defineProperty(t,"__esModule",{value:!0}),t.getMIDIInputById=t.getMIDIOutputById=t.getMIDIInputIds=t.getMIDIOutputIds=t.getMIDIInputs=t.getMIDIOutputs=t.getMIDIAccess=void 0,t.initMIDI=i;var r=void 0,o=!1,u=[],s=[],a=[],I=[],c=new Map,f=new Map,l=function(){return o!==!1?(t.getMIDIAccess=l=function(){return r},l()):(console.warn("please call qambi.init() first"),!1)};t.getMIDIAccess=l;var d=function(){return o!==!1?(t.getMIDIOutputs=d=function(){return s},d()):(console.warn("please call qambi.init() first"),!1)};t.getMIDIOutputs=d;var p=function(){return o!==!1?(t.getMIDIInputs=p=function(){return u},p()):(console.warn("please call qambi.init() first"),!1)};t.getMIDIInputs=p;var v=function(){return o!==!1?(t.getMIDIOutputIds=v=function(){return I},v()):(console.warn("please call qambi.init() first"),!1)};t.getMIDIOutputIds=v;var g=function(){return o!==!1?(t.getMIDIInputIds=g=function(){return a},g()):(console.warn("please call qambi.init() first"),!1)};t.getMIDIInputIds=g;var M=function(e){return o!==!1?(t.getMIDIOutputById=M=function(t){return f.get(t)},M(e)):(console.warn("please call qambi.init() first"),!1)};t.getMIDIOutputById=M;var y=function(e){return o!==!1?(t.getMIDIInputById=y=function(t){return c.get(t)},y(e)):(console.warn("please call qambi.init() first"),!1)};t.getMIDIInputById=y});
},{"./util":36}],10:[function(require,module,exports){
!function(e,t){if("function"==typeof define&&define.amd)define(["exports","./init_audio","./eventlistener"],t);else if("undefined"!=typeof exports)t(exports,require("./init_audio"),require("./eventlistener"));else{var n={exports:{}};t(n.exports,e.init_audio,e.eventlistener),e.instrument=n.exports}}(this,function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0}),e.Instrument=void 0;var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();e.Instrument=function(){function e(){i(this,e),this.scheduledSamples=new Map,this.sustainedSamples=[],this.sustainPedalDown=!1,this.output=null}return s(e,[{key:"connect",value:function(e){this.output=e}},{key:"disconnect",value:function(){this.output=null}},{key:"processMIDIEvent",value:function(e){var i=this,s=arguments.length<=1||void 0===arguments[1]?0:arguments[1],a=void 0;if(isNaN(s))return void console.error("invalid time value");if(0===s&&(s=t.context.currentTime),144===e.type)a=this.createSample(e),this.scheduledSamples.set(e.midiNoteId,a),a.output.connect(this.output),a.start(s);else if(128===e.type){if(a=this.scheduledSamples.get(e.midiNoteId),"undefined"==typeof a)return;this.sustainPedalDown===!0?this.sustainedSamples.push(e.midiNoteId):a.stop(s,function(){i.scheduledSamples["delete"](e.midiNoteId)})}else 176===e.type&&(64===e.data1?127===e.data2?(this.sustainPedalDown=!0,(0,n.dispatchEvent)({type:"sustainpedal",data:"down"})):0===e.data2&&(this.sustainPedalDown=!1,this.sustainedSamples.forEach(function(e){a=i.scheduledSamples.get(e),a&&a.stop(s,function(){i.scheduledSamples["delete"](e)})}),this.sustainedSamples=[],(0,n.dispatchEvent)({type:"sustainpedal",data:"up"})):10===e.data1||7===e.data1)}},{key:"allNotesOff",value:function(){this.sustainedSamples=[],this.sustainPedalDown===!0&&(0,n.dispatchEvent)({type:"sustainpedal",data:"up"}),this.sustainPedalDown=!1,this.scheduledSamples.forEach(function(e){e.stop(t.context.currentTime)}),this.scheduledSamples.clear()}},{key:"unschedule",value:function(e){var n=this.scheduledSamples.get(e.midiNoteId);n&&(n.stop(t.context.currentTime),this.scheduledSamples["delete"](e.midiNoteId))}}]),e}()});
},{"./eventlistener":5,"./init_audio":8}],11:[function(require,module,exports){
!function(e,t){if("function"==typeof define&&define.amd)define(["exports","./track","./part","./parse_events","./midi_event","./util","./position","./sampler","./init_audio","./constants"],t);else if("undefined"!=typeof exports)t(exports,require("./track"),require("./part"),require("./parse_events"),require("./midi_event"),require("./util"),require("./position"),require("./sampler"),require("./init_audio"),require("./constants"));else{var n={exports:{}};t(n.exports,e.track,e.part,e.parse_events,e.midi_event,e.util,e.position,e.sampler,e.init_audio,e.constants),e.metronome=n.exports}}(this,function(e,t,n,i,s,o,r,c,a,u){"use strict";function l(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0}),e.Metronome=void 0;var v=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),d=new Map([["volume","setVolume"],["instrument","setInstrument"],["noteNumberAccentedTick","setNoteNumberAccentedTick"],["noteNumberNonAccentedTick","setNoteNumberNonAccentedTick"],["velocityAccentedTick","setVelocityAccentedTick"],["velocityNonAccentedTick","setVelocityNonAccentedTick"],["noteLengthAccentedTick","setNoteLengthAccentedTick"],["noteLengthNonAccentedTick","setNoteLengthNonAccentedTick"]]);e.Metronome=function(){function e(i){h(this,e),this.song=i,this.track=new t.Track(this.song.id+"_metronome"),this.part=new n.Part,this.track.addParts(this.part),this.track.connect(this.song._output),this.events=[],this.precountEvents=[],this.precountDuration=0,this.bars=0,this.index=0,this.index2=0,this.precountIndex=0,this.reset()}return v(e,[{key:"reset",value:function(){var e=(0,a.getInitData)(),t=new c.Sampler("metronome");t.updateSampleData({note:60,buffer:e.lowtick},{note:61,buffer:e.hightick}),this.track.setInstrument(t),this.volume=1,this.noteNumberAccented=61,this.noteNumberNonAccented=60,this.velocityAccented=100,this.velocityNonAccented=100,this.noteLengthAccented=this.song.ppq/4,this.noteLengthNonAccented=this.song.ppq/4}},{key:"createEvents",value:function(e,t){var n=arguments.length<=2||void 0===arguments[2]?"init":arguments[2],i=void 0,o=void 0,c=void 0,a=void 0,u=void 0,l=void 0,h=void 0,v=void 0,d=0,p=void 0,f=void 0,m=[];for(i=e;t>=i;i++)for(c=(0,r.calculatePosition)(this.song,{type:"barsbeats",target:[i]}),h=c.nominator,v=c.ticksPerBeat,d=c.ticks,o=0;h>o;o++)l=0===o?this.noteNumberAccented:this.noteNumberNonAccented,u=0===o?this.noteLengthAccented:this.noteLengthNonAccented,a=0===o?this.velocityAccented:this.velocityNonAccented,p=new s.MIDIEvent(d,144,l,a),f=new s.MIDIEvent(d+u,128,l,0),"precount"===n&&(p._track=this.track,f._track=this.track,p._part={},f._part={}),m.push(p,f),d+=v;return m}},{key:"getEvents",value:function(){var e,t=arguments.length<=0||void 0===arguments[0]?1:arguments[0],n=arguments.length<=1||void 0===arguments[1]?this.song.bars:arguments[1],s=arguments.length<=2||void 0===arguments[2]?"init":arguments[2];return this.part.removeEvents(this.part.getEvents()),this.events=this.createEvents(t,n,s),(e=this.part).addEvents.apply(e,l(this.events)),this.bars=this.song.bars,this.allEvents=[].concat(l(this.events),l(this.song._timeEvents)),(0,o.sortEvents)(this.allEvents),(0,i.parseMIDINotes)(this.events),this.events}},{key:"setIndex2",value:function(e){this.index2=0}},{key:"getEvents2",value:function(e,t){for(var n=[],i=this.index2,s=this.allEvents.length;s>i;i++){var o=this.allEvents[i];if(o.type===u.MIDIEventTypes.TEMPO||o.type===u.MIDIEventTypes.TIME_SIGNATURE){if(!(o.millis<e))break;this.millisPerTick=o.millisPerTick,this.index2++}else{var r=o.ticks*this.millisPerTick;if(!(e>r))break;o.time=r+t,o.millis=r,n.push(o),this.index2++}}return n}},{key:"addEvents",value:function(){var e,t,n=arguments.length<=0||void 0===arguments[0]?1:arguments[0],i=arguments.length<=1||void 0===arguments[1]?this.song.bars:arguments[1],s=arguments.length<=2||void 0===arguments[2]?"add":arguments[2],o=this.createEvents(n,i,s);return(e=this.events).push.apply(e,l(o)),(t=this.part).addEvents.apply(t,l(o)),this.bars=i,o}},{key:"createPrecountEvents",value:function(e,t,n){this.timeStamp=n;var s=(0,r.calculatePosition)(this.song,{type:"barsbeats",target:[e],result:"millis"}),o=(0,r.calculatePosition)(this.song,{type:"barsbeats",target:[t],result:"millis"});return this.precountIndex=0,this.startMillis=s.millis,this.endMillis=o.millis,this.precountDuration=o.millis-this.startMillis,this.timeStamp-=this.startMillis,this.precountEvents=this.createEvents(e,t-1,"precount"),this.precountEvents=(0,i.parseEvents)([].concat(l(this.song._timeEvents),l(this.precountEvents))),this.precountDuration}},{key:"setPrecountIndex",value:function(e){var t=0,n=!0,i=!1,s=void 0;try{for(var o,r=this.events[Symbol.iterator]();!(n=(o=r.next()).done);n=!0){var c=o.value;if(c.millis>=e){this.precountIndex=t;break}t++}}catch(a){i=!0,s=a}finally{try{!n&&r["return"]&&r["return"]()}finally{if(i)throw s}}console.log(this.precountIndex)}},{key:"getPrecountEvents",value:function(e){var t=this.precountEvents,n=t.length,i=void 0,s=void 0,o=[];for(i=this.precountIndex;n>i&&(s=t[i],s.millis<e);i++)s.time=this.timeStamp+s.millis,o.push(s),this.precountIndex++;return o}},{key:"mute",value:function(e){this.track.muted=e}},{key:"allNotesOff",value:function(){this.track._instrument.allNotesOff()}},{key:"updateConfig",value:function(){this.init(1,this.bars,"update"),this.allNotesOff(),this.song.update()}},{key:"configure",value:function(e){Object.keys(e).forEach(function(t){this[d.get(t)](e.key)},this),this.updateConfig()}},{key:"setInstrument",value:function(e){return!e instanceof Instrument?void console.warn("not an instance of Instrument"):(this.track.setInstrument(e),void this.updateConfig())}},{key:"setNoteLengthAccentedTick",value:function(e){isNaN(e)&&console.warn("please provide a number"),this.noteLengthAccented=e,this.updateConfig()}},{key:"setNoteLengthNonAccentedTick",value:function(e){isNaN(e)&&console.warn("please provide a number"),this.noteLengthNonAccented=e,this.updateConfig()}},{key:"setVelocityAccentedTick",value:function(e){e=(0,o.checkMIDINumber)(e),e!==!1?this.velocityAccented=e:console.warn("please provide a number"),this.updateConfig()}},{key:"setVelocityNonAccentedTick",value:function(e){e=(0,o.checkMIDINumber)(e),e!==!1?this.velocityNonAccented=e:console.warn("please provide a number"),this.updateConfig()}},{key:"setNoteNumberAccentedTick",value:function(e){e=(0,o.checkMIDINumber)(e),e!==!1?this.noteNumberAccented=e:console.warn("please provide a number"),this.updateConfig()}},{key:"setNoteNumberNonAccentedTick",value:function(e){e=(0,o.checkMIDINumber)(e),e!==!1?this.noteNumberNonAccented=e:console.warn("please provide a number"),this.updateConfig()}},{key:"setVolume",value:function(e){this.track.setVolume(e)}}]),e}()});
},{"./constants":4,"./init_audio":8,"./midi_event":12,"./parse_events":18,"./part":19,"./position":21,"./sampler":26,"./track":35,"./util":36}],12:[function(require,module,exports){
!function(t,e){if("function"==typeof define&&define.amd)define(["exports","./note"],e);else if("undefined"!=typeof exports)e(exports,require("./note"));else{var i={exports:{}};e(i.exports,t.note),t.midi_event=i.exports}}(this,function(t,e){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.MIDIEvent=void 0;var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),o=0;t.MIDIEvent=function(){function t(n,a,s){var r=arguments.length<=3||void 0===arguments[3]?-1:arguments[3];if(i(this,t),this.id=this.constructor.name+"_"+o++ +"_"+(new Date).getTime(),this.ticks=n,this.type=a,this.data1=s,this.data2=r,144===a&&0===r&&(this.type=128),this._part=null,this._track=null,this._song=null,144===a||128===a){var u=(0,e.getNoteData)({number:s});this.noteName=u.name,this.fullNoteName=u.fullName,this.frequency=u.frequency,this.octave=u.octave}}return n(t,[{key:"copy",value:function(){var e=new t(this.ticks,this.type,this.data1,this.data2);return e}},{key:"transpose",value:function(t){this.data1+=t,this.frequency=440*Math.pow(2,(this.data1-69)/12)}},{key:"move",value:function(t){this.ticks+=t,this.midiNote&&this.midiNote.update()}},{key:"moveTo",value:function(t){this.ticks=t,this.midiNote&&this.midiNote.update()}}]),t}()});
},{"./note":16}],13:[function(require,module,exports){
!function(t,e){if("function"==typeof define&&define.amd)define(["exports","./midi_event"],e);else if("undefined"!=typeof exports)e(exports,require("./midi_event"));else{var i={exports:{}};e(i.exports,t.midi_event),t.midi_note=i.exports}}(this,function(t,e){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.MIDINote=void 0;var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),o=0;t.MIDINote=function(){function t(n,s){return i(this,t),144!==n.type?void console.warn("cannot create MIDINote"):(this.id=this.constructor.name+"_"+o++ +"_"+(new Date).getTime(),this.noteOn=n,n.midiNote=this,n.midiNoteId=this.id,void(s instanceof e.MIDIEvent&&(this.noteOff=s,s.midiNote=this,s.midiNoteId=this.id,this.durationTicks=s.ticks-n.ticks,this.durationMillis=-1)))}return n(t,[{key:"addNoteOff",value:function(t){this.noteOff=t,t.midiNote=this,t.midiNoteId=this.id,this.durationTicks=t.ticks-this.noteOn.ticks,this.durationMillis=-1}},{key:"copy",value:function(){return new t(this.noteOn.copy(),this.noteOff.copy())}},{key:"update",value:function(){this.durationTicks=this.noteOff.ticks-this.noteOn.ticks}},{key:"transpose",value:function(t){this.noteOn.transpose(t),this.noteOff.transpose(t)}},{key:"move",value:function(t){this.noteOn.move(t),this.noteOff.move(t)}},{key:"moveTo",value:function(t){this.noteOn.moveTo(t),this.noteOff.moveTo(t)}},{key:"unregister",value:function(){this.part&&(this.part.removeEvents(this),this.part=null),this.track&&(this.track.removeEvents(this),this.track=null),this.song&&(this.song.removeEvents(this),this.song=null)}}]),t}()});
},{"./midi_event":12}],14:[function(require,module,exports){
!function(t,i){if("function"==typeof define&&define.amd)define(["exports"],i);else if("undefined"!=typeof exports)i(exports);else{var e={exports:{}};i(e.exports),t.midi_stream=e.exports}}(this,function(t){"use strict";function i(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var e=function(){function t(t,i){for(var e=0;e<i.length;e++){var n=i[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(i,e,n){return e&&t(i.prototype,e),n&&t(i,n),i}}(),n=String.fromCharCode,o=function(){function t(e){i(this,t),this.buffer=e,this.position=0}return e(t,[{key:"read",value:function(t){var i=arguments.length<=1||void 0===arguments[1]?!0:arguments[1],e=void 0;if(i){e="";for(var o=0;t>o;o++,this.position++)e+=n(this.buffer[this.position]);return e}e=[];for(var r=0;t>r;r++,this.position++)e.push(this.buffer[this.position]);return e}},{key:"readInt32",value:function(){var t=(this.buffer[this.position]<<24)+(this.buffer[this.position+1]<<16)+(this.buffer[this.position+2]<<8)+this.buffer[this.position+3];return this.position+=4,t}},{key:"readInt16",value:function(){var t=(this.buffer[this.position]<<8)+this.buffer[this.position+1];return this.position+=2,t}},{key:"readInt8",value:function(t){var i=this.buffer[this.position];return t&&i>127&&(i-=256),this.position+=1,i}},{key:"eof",value:function(){return this.position>=this.buffer.length}},{key:"readVarInt",value:function(){for(var t=0;;){var i=this.readInt8();if(!(128&i))return t+i;t+=127&i,t<<=7}}},{key:"reset",value:function(){this.position=0}},{key:"setPosition",value:function(t){this.position=t}}]),t}();t["default"]=o});
},{}],15:[function(require,module,exports){
!function(e,t){if("function"==typeof define&&define.amd)define(["exports","./midi_stream"],t);else if("undefined"!=typeof exports)t(exports,require("./midi_stream"));else{var r={exports:{}};t(r.exports,e.midi_stream),e.midifile=r.exports}}(this,function(e,t){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function n(e){var t=e.read(4,!0),r=e.readInt32();return{id:t,length:r,data:e.read(r,!1)}}function a(e){var t,r={};r.deltaTime=e.readVarInt();var n=e.readInt8();if(240==(240&n)){if(255==n){r.type="meta";var a=e.readInt8();switch(t=e.readVarInt(),a){case 0:if(r.subtype="sequenceNumber",2!==t)throw"Expected length for sequenceNumber event is 2, got "+t;return r.number=e.readInt16(),r;case 1:return r.subtype="text",r.text=e.read(t),r;case 2:return r.subtype="copyrightNotice",r.text=e.read(t),r;case 3:return r.subtype="trackName",r.text=e.read(t),i=r.text,r;case 4:return r.subtype="instrumentName",r.text=e.read(t),r;case 5:return r.subtype="lyrics",r.text=e.read(t),r;case 6:return r.subtype="marker",r.text=e.read(t),r;case 7:return r.subtype="cuePoint",r.text=e.read(t),r;case 32:if(r.subtype="midiChannelPrefix",1!==t)throw"Expected length for midiChannelPrefix event is 1, got "+t;return r.channel=e.readInt8(),r;case 47:if(r.subtype="endOfTrack",0!==t)throw"Expected length for endOfTrack event is 0, got "+t;return r;case 81:if(r.subtype="setTempo",3!==t)throw"Expected length for setTempo event is 3, got "+t;return r.microsecondsPerBeat=(e.readInt8()<<16)+(e.readInt8()<<8)+e.readInt8(),r;case 84:if(r.subtype="smpteOffset",5!==t)throw"Expected length for smpteOffset event is 5, got "+t;var d=e.readInt8();return r.frameRate={0:24,32:25,64:29,96:30}[96&d],r.hour=31&d,r.min=e.readInt8(),r.sec=e.readInt8(),r.frame=e.readInt8(),r.subframe=e.readInt8(),r;case 88:if(r.subtype="timeSignature",4!==t)throw"Expected length for timeSignature event is 4, got "+t;return r.numerator=e.readInt8(),r.denominator=Math.pow(2,e.readInt8()),r.metronome=e.readInt8(),r.thirtyseconds=e.readInt8(),r;case 89:if(r.subtype="keySignature",2!==t)throw"Expected length for keySignature event is 2, got "+t;return r.key=e.readInt8(!0),r.scale=e.readInt8(),r;case 127:return r.subtype="sequencerSpecific",r.data=e.read(t),r;default:return r.subtype="unknown",r.data=e.read(t),r}return r.data=e.read(t),r}if(240==n)return r.type="sysEx",t=e.readVarInt(),r.data=e.read(t),r;if(247==n)return r.type="dividedSysEx",t=e.readVarInt(),r.data=e.read(t),r;throw"Unrecognised MIDI event type byte: "+n}var u=void 0;0===(128&n)?(u=n,n=s):(u=e.readInt8(),s=n);var o=n>>4;switch(r.channel=15&n,r.type="channel",o){case 8:return r.subtype="noteOff",r.noteNumber=u,r.velocity=e.readInt8(),r;case 9:return r.noteNumber=u,r.velocity=e.readInt8(),0===r.velocity?r.subtype="noteOff":r.subtype="noteOn",r;case 10:return r.subtype="noteAftertouch",r.noteNumber=u,r.amount=e.readInt8(),r;case 11:return r.subtype="controller",r.controllerType=u,r.value=e.readInt8(),r;case 12:return r.subtype="programChange",r.programNumber=u,r;case 13:return r.subtype="channelAftertouch",r.amount=u,r;case 14:return r.subtype="pitchBend",r.value=u+(e.readInt8()<<7),r;default:return r.value=e.readInt8(),r.subtype="unknown",r}}function d(e){if(e instanceof Uint8Array==!1&&e instanceof ArrayBuffer==!1)return void console.error("buffer should be an instance of Uint8Array of ArrayBuffer");e instanceof ArrayBuffer&&(e=new Uint8Array(e));var t=new Map,r=new u["default"](e),d=n(r);if("MThd"!==d.id||6!==d.length)throw"Bad .mid file - header not found";var s=new u["default"](d.data),o=s.readInt16(),f=s.readInt16(),c=s.readInt16();if(32768&c)throw"Expressing time division in SMTPE frames is not supported yet";for(var p={formatType:o,trackCount:f,ticksPerBeat:c},y=0;f>y;y++){i="track_"+y;var m=[],l=n(r);if("MTrk"!==l.id)throw"Unexpected chunk - expected MTrk, got "+l.id;for(var h=new u["default"](l.data);!h.eof();){var b=a(h);m.push(b)}t.set(i,m)}return{header:p,tracks:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.parseMIDIFile=d;var u=r(t),s=void 0,i=void 0});
},{"./midi_stream":14}],16:[function(require,module,exports){
!function(e,n){if("function"==typeof define&&define.amd)define(["exports","./settings"],n);else if("undefined"!=typeof exports)n(exports,require("./settings"));else{var t={exports:{}};n(t.exports,e.settings),e.note=t.exports}}(this,function(e,n){"use strict";function t(e){var n=e.fullName,t=e.name,o=e.octave,s=e.mode,c=e.number,v=e.frequency;if("string"!=typeof t&&"string"!=typeof n&&"number"!=typeof c&&"number"!=typeof v)return null;if(0>c||c>127)return console.log("please provide a note between 0 (C-1) and 127 (G9)"),null;if(s=l(s),"number"==typeof c){var m=r(c,s);n=m.fullName,t=m.name,o=m.octave}else if("string"==typeof t){if(!b.test(t))return console.log("invalid name "+t),null;n=""+t+o,c=i(t,o)}else if("string"==typeof n){if(!d.test(n))return console.log("invalid fullname "+n),null;var p=a(n);o=p.octave,t=p.name,c=i(t,o)}var y={name:t,octave:o,fullName:n,number:c,frequency:f(c),blackKey:u(c)};return y}function r(e){var t=arguments.length<=1||void 0===arguments[1]?n.noteNameMode:arguments[1],r=c(e/12-1),o=m[t][e%12];return{fullName:""+o+r,name:o,octave:r}}function o(e){return parseInt(e.match(v)[0],10)}function a(e){var n=o(e);return{octave:n,name:e.replace(n,"")}}function i(e,n){var t=Object.keys(m),r=void 0,o=!0,a=!1,i=void 0;try{for(var f,l=t[Symbol.iterator]();!(o=(f=l.next()).done);o=!0){var u=f.value,s=m[u];if(r=s.findIndex(function(n){return n===e}),-1!==r)break}}catch(c){a=!0,i=c}finally{try{!o&&l["return"]&&l["return"]()}finally{if(a)throw i}}var b=r+12+12*n;return 0>b||b>127?(console.log("please provide a note between 0 (C-1) and 127 (G9)"),-1):b}function f(e){return n.pitch*s(2,(e-69)/12)}function l(e){var t=Object.keys(m),r=t.includes(e);return r===!1&&("undefined"!=typeof e&&console.log(e+' is not a valid note name mode, using "'+n.noteNameMode+'" instead'),e=n.noteNameMode),e}function u(e){var n=void 0;switch(!0){case e%12===1:case e%12===3:case e%12===6:case e%12===8:case e%12===10:n=!0;break;default:n=!1}return n}Object.defineProperty(e,"__esModule",{value:!0}),e.getNoteData=t;var s=Math.pow,c=Math.floor,b=/^[A-G]{1}(b|bb|#|##){0,1}$/,d=/^[A-G]{1}(b|bb|#|##){0,1}(\-1|[0-9]{1})$/,v=/(\-1|[0-9]{1})$/,m={sharp:["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],flat:["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],"enharmonic-sharp":["B#","C#","C##","D#","D##","E#","F#","F##","G#","G##","A#","A##"],"enharmonic-flat":["Dbb","Db","Ebb","Eb","Fb","Gbb","Gb","Abb","Ab","Bbb","Bb","Cb"]}});
},{"./settings":30}],17:[function(require,module,exports){
!function(e,n){if("function"==typeof define&&define.amd)define(["exports","isomorphic-fetch","./init_audio","./util","./eventlistener"],n);else if("undefined"!=typeof exports)n(exports,require("isomorphic-fetch"),require("./init_audio"),require("./util"),require("./eventlistener"));else{var t={exports:{}};n(t.exports,e.isomorphicFetch,e.init_audio,e.util,e.eventlistener),e.parse_audio=t.exports}}(this,function(e,n,t,o,r){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function f(e,n,o){return new Promise(function(r){try{t.context.decodeAudioData(e,function(e){"undefined"!=typeof n?(r({id:n,buffer:e}),o&&o({id:n,buffer:e})):(r(e),o&&o(e))},function(){console.log("error decoding audiodata [ID: "+n+"]"),"undefined"!=typeof n?r({id:n}):r()})}catch(i){console.warn("error decoding audiodata",n,i),"undefined"!=typeof n?r({id:n}):r()}})}function u(e,n,t){(0,r.dispatchEvent)({type:"loading",data:e});var o=function(o){(0,s["default"])(e,{method:"GET"}).then(function(e){e.ok?e.arrayBuffer().then(function(e){f(e,n,t).then(o)}):"undefined"!=typeof n?o({id:n}):o()})};return new Promise(o)}function a(e,n,t,r,i){var a=function c(){"release"!==t&&"info"!==t&&"sustain"!==t&&(n instanceof ArrayBuffer?e.push(f(n,t,r,i)):"string"==typeof n?(0,o.checkIfBase64)(n)?e.push(f((0,o.base64ToBinary)(n),t,r,i)):e.push(u(r+escape(n),t,i)):"object"===("undefined"==typeof n?"undefined":p(n))&&(n=n.sample||n.buffer||n.base64||n.url,c(e,n,t,r,i)))};a()}function c(e){var n=arguments.length<=1||void 0===arguments[1]?!1:arguments[1],t=(0,o.typeString)(e),r=[],i="";return"string"==typeof e.baseUrl&&(i=e.baseUrl,delete e.baseUrl),n="function"==typeof n?n:!1,"object"===t?Object.keys(e).forEach(function(t){var f=e[t];"array"===(0,o.typeString)(f)?f.forEach(function(e){a(r,e,t,i,n)}):a(r,f,t,i,n)}):"array"===t&&!function(){var t=void 0;e.forEach(function(e){a(r,e,t,i,n)})}(),new Promise(function(n){Promise.all(r).then(function(r){"object"===t?(e={},r.forEach(function(n){var t=e[n.id],r=(0,o.typeString)(t);"undefined"!==r?"array"===r?t.push(n.buffer):e[n.id]=[t,n.buffer]:e[n.id]=n.buffer}),n(e)):"array"===t&&n(r)})})}function d(){for(var e=arguments.length,n=Array(e),t=0;e>t;t++)n[t]=arguments[t];return c(1===n.length&&"string"!==(0,o.typeString)(n[0])?n[0]:n)}Object.defineProperty(e,"__esModule",{value:!0}),e.decodeSample=f,e.parseSamples2=c,e.parseSamples=d;var s=i(n),p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}});
},{"./eventlistener":5,"./init_audio":8,"./util":36,"isomorphic-fetch":2}],18:[function(require,module,exports){
!function(e,t){if("function"==typeof define&&define.amd)define(["exports","./util","./midi_note"],t);else if("undefined"!=typeof exports)t(exports,require("./util"),require("./midi_note"));else{var i={exports:{}};t(i.exports,e.util,e.midi_note),e.parse_events=i.exports}}(this,function(e,t,i){"use strict";function r(){g=1/y*60/u/l,S=1e3*g}function n(){v=4/p,w=4*v,A=l*v,I=A*k,T=l/4}function o(e){var t=arguments.length<=1||void 0===arguments[1]?!1:arguments[1];if(B=e.ticks-P,x+=B,P=e.ticks,_+=B*S,t===!1)for(;x>=T;)for(b++,x-=T;b>w;)for(b-=w,h++;h>k;)h-=k,m++}function a(e,t){var i=arguments.length<=2||void 0===arguments[2]?!1:arguments[2],a=void 0,c=void 0;l=e.ppq,u=e.bpm,k=e.nominator,p=e.denominator,y=e.playbackSpeed,m=1,h=1,b=1,x=0,P=0,_=0,r(),n(),t.sort(function(e,t){return e.ticks<=t.ticks?-1:1});var d=!0,f=!1,v=void 0;try{for(var S,g=t[Symbol.iterator]();!(d=(S=g.next()).done);d=!0){switch(c=S.value,a=c.type,o(c,i),a){case 81:u=c.data1,r();break;case 88:k=c.data1,p=c.data2,n();break;default:continue}s(c,i)}}catch(A){f=!0,v=A}finally{try{!d&&g["return"]&&g["return"]()}finally{if(f)throw v}}}function c(e){var t=arguments.length<=1||void 0===arguments[1]?!1:arguments[1],i=void 0,r=0,n=0,a=[];x=0,P=0,B=0;var c=e.length;e.sort(function(e,t){if(e.ticks===t.ticks){var i=e.type-t.type;return 176===e.type&&144===t.type&&(i=-1),i}return e.ticks-t.ticks}),i=e[0],u=i.bpm,v=i.factor,k=i.nominator,p=i.denominator,I=i.ticksPerBar,A=i.ticksPerBeat,T=i.ticksPerSixteenth,w=i.numSixteenth,S=i.millisPerTick,g=i.secondsPerTick,_=i.millis,m=i.bar,h=i.beat,b=i.sixteenth,x=i.tick;for(var f=r;c>f;f++){switch(i=e[f],i.type){case 81:u=i.data1,_=i.millis,S=i.millisPerTick,g=i.secondsPerTick,B=i.ticks-P,x+=B,P=i.ticks;break;case 88:v=i.factor,k=i.data1,p=i.data2,w=i.numSixteenth,I=i.ticksPerBar,A=i.ticksPerBeat,T=i.ticksPerSixteenth,_=i.millis,B=i.ticks-P,x+=B,P=i.ticks;break;default:o(i,t),s(i,t),a.push(i)}n=i.ticks}return d(a),a}function s(e){var i=arguments.length<=1||void 0===arguments[1]?!1:arguments[1];if(e.bpm=u,e.nominator=k,e.denominator=p,e.ticksPerBar=I,e.ticksPerBeat=A,e.ticksPerSixteenth=T,e.factor=v,e.numSixteenth=w,e.secondsPerTick=g,e.millisPerTick=S,e.ticks=P,e.millis=_,e.seconds=_/1e3,!i){e.bar=m,e.beat=h,e.sixteenth=b,e.tick=x;var r=0===x?"000":10>x?"00"+x:100>x?"0"+x:x;e.barsAsString=m+":"+h+":"+b+":"+r,e.barsAsArray=[m,h,b,x];var n=(0,t.getNiceTime)(_);e.hour=n.hour,e.minute=n.minute,e.second=n.second,e.millisecond=n.millisecond,e.timeAsString=n.timeAsString,e.timeAsArray=n.timeAsArray}}function d(e){var t={},r=void 0,n=!0,o=!1,a=void 0;try{for(var c,s=e[Symbol.iterator]();!(n=(c=s.next()).done);n=!0){var d=c.value;if("undefined"!=typeof d._part&&"undefined"!=typeof d._track){if(144===d.type)r=t[d._track.id],"undefined"==typeof r&&(r=t[d._track.id]={}),r[d.data1]=d;else if(128===d.type){if(r=t[d._track.id],"undefined"==typeof r)continue;var f=r[d.data1],l=d;if("undefined"==typeof f){delete t[d._track.id][d.data1];continue}var u=new i.MIDINote(f,l);u._track=f._track,u=null,delete t[d._track.id][d.data1]}}else console.log("no part and/or track set",d)}}catch(v){o=!0,a=v}finally{try{!n&&s["return"]&&s["return"]()}finally{if(o)throw a}}Object.keys(t).forEach(function(e){delete t[e]}),t={}}function f(e){var t={},i={},r=[],n=!0,o=!1,a=void 0;try{for(var c,s=e[Symbol.iterator]();!(n=(c=s.next()).done);n=!0){var d=c.value;if(176===d.type&&64===d.data1)if(0===d.data2){if("undefined"==typeof t[d.trackId])continue;if(t[d.trackId]===d.ticks){delete i[d.ticks];continue}i[d.ticks]=d,delete t[d.trackId]}else 127===d.data2&&(t[d.trackId]=d.ticks,i[d.ticks]=d);else r.push(d)}}catch(f){o=!0,a=f}finally{try{!n&&s["return"]&&s["return"]()}finally{if(o)throw a}}return console.log(t),Object.keys(i).forEach(function(e){var t=i[e];console.log(t),r.push(t)}),r}Object.defineProperty(e,"__esModule",{value:!0}),e.parseTimeEvents=a,e.parseEvents=c,e.parseMIDINotes=d,e.filterEvents=f;var l=void 0,u=void 0,v=void 0,k=void 0,p=void 0,y=void 0,m=void 0,h=void 0,b=void 0,x=void 0,P=void 0,_=void 0,S=void 0,g=void 0,A=void 0,I=void 0,T=void 0,w=void 0,B=void 0});
},{"./midi_note":13,"./util":36}],19:[function(require,module,exports){
!function(e,t){if("function"==typeof define&&define.amd)define(["exports","./util"],t);else if("undefined"!=typeof exports)t(exports,require("./util"));else{var n={exports:{}};t(n.exports,e.util),e.part=n.exports}}(this,function(e,t){"use strict";function n(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0}),e.Part=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),a=0;e.Part=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?null:arguments[0];s(this,e),this.id=this.constructor.name+"_"+a++ +"_"+(new Date).getTime(),this.name=t||this.id,this.muted=!1,this._track=null,this._song=null,this._events=[],this._eventsById=new Map,this._needsUpdate=!1,this._createEventArray=!1,this._start={millis:0,ticks:0},this._end={millis:0,ticks:0}}return i(e,[{key:"copy",value:function(){var t=new e(this.name+"_copy"),n=[];return this._events.forEach(function(e){var t=e.copy();console.log(t),n.push(t)}),t.addEvents.apply(t,n),t.update(),t}},{key:"transpose",value:function(e){this._events.forEach(function(t){t.transpose(e)}),this._needsUpdate=!0}},{key:"move",value:function(e){if(this._events.forEach(function(t){t.move(e)}),this._song){var t;(t=this._song._movedEvents).push.apply(t,n(this._events))}this._needsUpdate=!0}},{key:"moveTo",value:function(e){if(this._events.forEach(function(t){t.moveTo(e)}),this._song){var t;(t=this._song._movedEvents).push.apply(t,n(this._events))}this._needsUpdate=!0}},{key:"addEvents",value:function(){for(var e,t=this,n=this._track,s=arguments.length,i=Array(s),a=0;s>a;a++)i[a]=arguments[a];if(i.forEach(function(e){e._part=t,t._eventsById.set(e.id,e),n&&(e._track=n,n._song&&(e._song=n._song))}),(e=this._events).push.apply(e,i),n){var r;(r=n._events).push.apply(r,i),n._needsUpdate=!0}if(this._song){var o;(o=this._song._newEvents).push.apply(o,i),this._song._changedParts.push(this)}this._needsUpdate=!0}},{key:"removeEvents",value:function(){for(var e=this,t=this._track,n=arguments.length,s=Array(n),i=0;n>i;i++)s[i]=arguments[i];if(s.forEach(function(n){n._part=null,e._eventsById["delete"](n.id),t&&(n._track=null,t._eventsById["delete"](n.id),t._song&&(n._song=null))}),t&&(t._needsUpdate=!0,t._createEventArray=!0),this._song){var a;(a=this._song._removedEvents).push.apply(a,s),this._song._changedParts.push(this)}this._createEventArray=!0,this._needsUpdate=!0}},{key:"moveEvents",value:function(e){for(var t=arguments.length,s=Array(t>1?t-1:0),i=1;t>i;i++)s[i-1]=arguments[i];if(s.forEach(function(t){t.move(e)}),this._song){var a;this._song._changedParts.push(this),(a=this._song._movedEvents).push.apply(a,n(this._events))}this._needsUpdate=!0}},{key:"moveEventsTo",value:function(e){for(var t=arguments.length,s=Array(t>1?t-1:0),i=1;t>i;i++)s[i-1]=arguments[i];if(s.forEach(function(t){t.moveTo(e)}),this._song){var a;this._song._changedParts.push(this),(a=this._song._movedEvents).push.apply(a,n(this._events))}this._needsUpdate=!0}},{key:"getEvents",value:function(){arguments.length<=0||void 0===arguments[0]?null:arguments[0];return this._needsUpdate&&this.update(),[].concat(n(this._events))}},{key:"mute",value:function(){var e=arguments.length<=0||void 0===arguments[0]?null:arguments[0];e?this.muted=e:this.muted=!this.muted}},{key:"update",value:function(){this._needsUpdate!==!1&&(this._createEventArray&&(this._events=Array.from(this._eventsById.values()),this._createEventArray=!1),(0,t.sortEvents)(this._events),this._needsUpdate=!1)}}]),e}()});
},{"./util":36}],20:[function(require,module,exports){
!function(t,e){if("function"==typeof define&&define.amd)define(["exports","./position.js","./eventlistener.js","./util.js"],e);else if("undefined"!=typeof exports)e(exports,require("./position.js"),require("./eventlistener.js"),require("./util.js"));else{var i={exports:{}};e(i.exports,t.position,t.eventlistener,t.util),t.playhead=i.exports}}(this,function(t,e,i,s){"use strict";function n(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.Playhead=void 0;var h=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),r=10,o=0;t.Playhead=function(){function t(e){var i=arguments.length<=1||void 0===arguments[1]?"all":arguments[1];a(this,t),this.id=this.constructor.name+"_"+o++ +"_"+(new Date).getTime(),this.song=e,this.type=i,this.lastEvent=null,this.data={},this.activeParts=[],this.activeNotes=[],this.activeEvents=[]}return h(t,[{key:"set",value:function(t,e){return this.unit=t,this.currentValue=e,this.eventIndex=0,this.noteIndex=0,this.partIndex=0,this.calculate(),this.data}},{key:"get",value:function(){return this.data}},{key:"update",value:function(t,e){return 0===e?this.data:(this.unit=t,this.currentValue+=e,this.calculate(),this.data)}},{key:"updateSong",value:function(){this.events=[].concat(n(this.song._events),n(this.song._timeEvents)),(0,s.sortEvents)(this.events),this.notes=this.song._notes,this.parts=this.song._parts,this.numEvents=this.events.length,this.numNotes=this.notes.length,this.numParts=this.parts.length,this.set("millis",this.song._currentMillis)}},{key:"calculate",value:function(){var t=void 0,s=void 0,a=void 0,h=void 0,o=void 0,d=void 0,u=[],c=[],l=new Set,v=new Set;this.data={},this.activeEvents=[];var f=[];for(t=this.eventIndex;t<this.numEvents&&(a=this.events[t],s=a[this.unit],s<=this.currentValue);t++)(0===s||s>this.currentValue-r)&&(this.activeEvents.push(a),176===a.type&&64===a.data1&&((0,i.dispatchEvent)({type:"sustainpedal2",data:127===a.data2?"down":"up"}),f.push(a)),(0,i.dispatchEvent)({type:"event",data:a})),this.lastEvent=a,this.eventIndex++;if(this.data.activeEvents=this.activeEvents,null===this.lastEvent&&(this.lastEvent=this.song._timeEvents[0]),d=(0,e.getPosition2)(this.song,this.unit,this.currentValue,"all",this.lastEvent),this.data.eventIndex=this.eventIndex,this.data.millis=d.millis,this.data.ticks=d.ticks,this.data.position=d,-1!==this.type.indexOf("all")){var p=this.data,y=!0,g=!1,x=void 0;try{for(var m,E=Object.keys(d)[Symbol.iterator]();!(y=(m=E.next()).done);y=!0){var O=m.value;p[O]=d[O]}}catch(P){g=!0,x=P}finally{try{!y&&E["return"]&&E["return"]()}finally{if(g)throw x}}}else-1!==this.type.indexOf("barsbeats")?(this.data.bar=d.bar,this.data.beat=d.beat,this.data.sixteenth=d.sixteenth,this.data.tick=d.tick,this.data.barsAsString=d.barsAsString,this.data.ticksPerBar=d.ticksPerBar,this.data.ticksPerBeat=d.ticksPerBeat,this.data.ticksPerSixteenth=d.ticksPerSixteenth,this.data.numSixteenth=d.numSixteenth):-1!==this.type.indexOf("time")?(this.data.hour=d.hour,this.data.minute=d.minute,this.data.second=d.second,this.data.millisecond=d.millisecond,this.data.timeAsString=d.timeAsString):-1!==this.type.indexOf("percentage")&&(this.data.percentage=d.percentage);if(-1!==this.type.indexOf("notes")||-1!==this.type.indexOf("all")){for(t=this.noteIndex;t<this.numNotes&&(h=this.notes[t],s=h.noteOn[this.unit],s<=this.currentValue);t++)this.noteIndex++,"undefined"!=typeof h.noteOff&&(0===this.currentValue||h.noteOff[this.unit]>this.currentValue)&&(v.add(h),(0,i.dispatchEvent)({type:"noteOn",data:h.noteOn}));for(t=this.activeNotes.length-1;t>=0;t--)h=this.activeNotes[t],this.song._notesById.get(h.id)!==!1&&("undefined"!=typeof h.noteOff?h.noteOff[this.unit]>this.currentValue?u.push(h):(0,i.dispatchEvent)({type:"noteOff",data:h.noteOff}):console.warn("note with id",h.id,"has no noteOff event"));this.activeNotes=[].concat(n(v.values()),u),this.data.activeNotes=this.activeNotes}if(-1!==this.type.indexOf("parts")||-1!==this.type.indexOf("all")){for(t=this.partIndex;t<this.numParts&&(o=this.parts[t],o._start[this.unit]<=this.currentValue);t++)l.add(o),(0,i.dispatchEvent)({type:"partOn",data:o}),this.partIndex++;for(t=this.activeParts.length-1;t>=0;t--)o=this.activeParts[t],this.song._partsById.get(o.id)!==!1&&(o._end[this.unit]>this.currentValue?c.push(h):(0,i.dispatchEvent)({type:"partOff",data:o}));this.activeParts=[].concat(n(l.values()),c),this.data.activeParts=this.activeParts}(0,i.dispatchEvent)({type:"position",data:this.data})}}]),t}()});
},{"./eventlistener.js":5,"./position.js":21,"./util.js":36}],21:[function(require,module,exports){
!function(e,i){if("function"==typeof define&&define.amd)define(["exports","./util"],i);else if("undefined"!=typeof exports)i(exports,require("./util"));else{var t={exports:{}};i(t.exports,e.util),e.position=t.exports}}(this,function(e,i){"use strict";function t(e,i,t){for(var r=e._timeEvents,n=r.length-1;n>=0;n--){var s=r[n];if(s[i]<=t)return F=n,s}return null}function r(e,i){var t=arguments.length<=2||void 0===arguments[2]?!0:arguments[2];return H=t,c(e,i),j}function n(e,i){var t=arguments.length<=2||void 0===arguments[2]?!0:arguments[2];return H=t,u(e,i),N}function s(e,i,t){return p(e,{type:"barsbeat",position:i,result:"millis",beos:t}),N}function o(e,i,t){return p(e,{type:"barsbeats",position:i,result:"ticks",beos:t}),j}function a(e,i){var t=arguments.length<=2||void 0===arguments[2]?!0:arguments[2];return H=t,u(e,i),v(),G="barsandbeats",b()}function l(e,i){var t=arguments.length<=2||void 0===arguments[2]?!0:arguments[2];return H=t,c(e,i),v(),G="barsandbeats",b()}function c(e,i,r){var n=e._lastEvent;return H===!1&&i>n.millis&&(i=n.millis),"undefined"==typeof r&&(r=t(e,"millis",i)),f(r),r.millis===i?(q=0,R=0):(q=i-r.millis,R=q/E),N+=q,j+=R}function u(e,i,r){var n=e._lastEvent;return H===!1&&i>n.ticks&&(i=n.ticks),"undefined"==typeof r&&(r=t(e,"ticks",i)),f(r),r.ticks===i?(R=0,q=0):(R=i-j,q=R*E),j+=R,N+=q}function d(e,i,r,n,s){var o=arguments.length<=5||void 0===arguments[5]?null:arguments[5],a=0,l=void 0,c=void 0,u=void 0,d=void 0,v=e._lastEvent;for(H===!1&&i>v.bar&&(i=v.bar),null===o&&(o=t(e,"bar",i)),f(o);s>=B;)n++,s-=B;for(;n>O;)r++,n-=O;for(;r>S;)i++,r-=S;for(o=t(e,"bar",i,F),a=F;a>=0;a--)if(o=e._timeEvents[a],o.bar<=i){f(o);break}d=s-D,u=n-C,c=r-z,l=i-I,q=l*w*E,q+=c*A*E,q+=u*B*E,q+=d*E,R=q/E,I=i,z=r,C=n,D=s,N+=q,j+=R}function v(){for(var e=x(R);e>=B;)for(C++,e-=B;C>O;)for(C-=O,z++;z>S;)z-=S,I++;D=x(e)}function f(e){P=e.bpm,S=e.nominator,_=e.denominator,w=e.ticksPerBar,A=e.ticksPerBeat,B=e.ticksPerSixteenth,O=e.numSixteenth,E=e.millisPerTick,M=e.secondsPerTick,I=e.bar,z=e.beat,C=e.sixteenth,D=e.tick,j=e.ticks,N=e.millis}function b(e){var t=void 0,r={};switch(G){case"millis":r.millis=x(1e3*N)/1e3,r.millisRounded=x(N);break;case"ticks":r.ticks=x(j);break;case"barsbeats":case"barsandbeats":r.bar=I,r.beat=z,r.sixteenth=C,r.tick=D,r.barsAsString=I+":"+z+":"+C+":"+m(D);break;case"time":t=(0,i.getNiceTime)(N),r.hour=t.hour,r.minute=t.minute,r.second=t.second,r.millisecond=t.millisecond,r.timeAsString=t.timeAsString;break;case"all":r.millis=x(1e3*N)/1e3,r.millisRounded=x(N),r.ticks=x(j),r.bar=I,r.beat=z,r.sixteenth=C,r.tick=D,r.barsAsString=I+":"+z+":"+C+":"+m(D),t=(0,i.getNiceTime)(N),r.hour=t.hour,r.minute=t.minute,r.second=t.second,r.millisecond=t.millisecond,r.timeAsString=t.timeAsString,r.bpm=x(P*e.playbackSpeed,3),r.nominator=S,r.denominator=_,r.ticksPerBar=w,r.ticksPerBeat=A,r.ticksPerSixteenth=B,r.numSixteenth=O,r.millisPerTick=E,r.secondsPerTick=M,r.percentage=j/e._durationTicks;break;default:return null}return r}function m(e){return 0===e?e="000":10>e?e="00"+e:100>e&&(e="0"+e),e}function k(e,i,t,r,n){return"millis"===i?c(e,t,n):"ticks"===i&&u(e,t,n),G=r,"all"===G&&v(),b(e)}function p(e,i){var t=i.type,r=i.target,n=i.result,s=void 0===n?"all":n,o=i.beos,a=void 0===o?!0:o,l=i.snap,f=void 0===l?-1:l;if(-1===y.indexOf(s)&&(console.warn("unsupported return type, 'all' used instead of '"+s+"'"),s="all"),G=s,H=a,-1===g.indexOf(t))return console.error("unsupported type "+t),!1;switch(t){case"barsbeats":case"barsandbeats":var m=h(r,4),k=m[0],p=void 0===k?1:k,x=m[1],P=void 0===x?1:x,S=m[2],_=void 0===S?1:S,A=m[3],w=void 0===A?0:A;return d(e,p,P,_,w),b(e);case"time":var B=h(r,4),E=B[0],M=void 0===E?0:E,O=B[1],N=void 0===O?0:O,R=B[2],q=void 0===R?0:R,I=B[3],z=void 0===I?0:I,C=0;return C+=60*M*60*1e3,C+=60*N*1e3,C+=1e3*q,C+=z,c(e,C),v(),b(e);case"millis":return c(e,r),v(),b(e);case"ticks":return u(e,r),v(),b(e);case"perc":case"percentage":j=r*e._durationTicks,-1!==f&&(j=T(j/f)*f),u(e,j),v();var D=b(e);return D;default:return!1}}Object.defineProperty(e,"__esModule",{value:!0}),e.millisToTicks=r,e.ticksToMillis=n,e.barsToMillis=s,e.barsToTicks=o,e.ticksToBars=a,e.millisToBars=l,e.getPosition2=k,e.calculatePosition=p;var h=function(){function e(e,i){var t=[],r=!0,n=!1,s=void 0;try{for(var o,a=e[Symbol.iterator]();!(r=(o=a.next()).done)&&(t.push(o.value),!i||t.length!==i);r=!0);}catch(l){n=!0,s=l}finally{try{!r&&a["return"]&&a["return"]()}finally{if(n)throw s}}return t}return function(i,t){if(Array.isArray(i))return i;if(Symbol.iterator in Object(i))return e(i,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),g="barsandbeats barsbeats time millis ticks perc percentage",y="barsandbeats barsbeats time millis ticks all",T=Math.floor,x=Math.round,P=void 0,S=void 0,_=void 0,A=void 0,w=void 0,B=void 0,E=void 0,M=void 0,O=void 0,j=void 0,N=void 0,R=void 0,q=void 0,I=void 0,z=void 0,C=void 0,D=void 0,F=void 0,G="all",H=!0});
},{"./util":36}],22:[function(require,module,exports){
!function(e,t){if("function"==typeof define&&define.amd)define(["exports","./note","./midi_event","./midi_note","./part","./track","./song","./instrument","./sampler","./simple_synth","./midifile","./init","./init_audio","./init_midi","./parse_audio","./constants","./settings","./eventlistener"],t);else if("undefined"!=typeof exports)t(exports,require("./note"),require("./midi_event"),require("./midi_note"),require("./part"),require("./track"),require("./song"),require("./instrument"),require("./sampler"),require("./simple_synth"),require("./midifile"),require("./init"),require("./init_audio"),require("./init_midi"),require("./parse_audio"),require("./constants"),require("./settings"),require("./eventlistener"));else{var I={exports:{}};t(I.exports,e.note,e.midi_event,e.midi_note,e.part,e.track,e.song,e.instrument,e.sampler,e.simple_synth,e.midifile,e.init,e.init_audio,e.init_midi,e.parse_audio,e.constants,e.settings,e.eventlistener),e.qambi=I.exports}}(this,function(e,t,I,n,s,i,r,u,p,a,o,g,M,m,D,d,l,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Sampler=e.SimpleSynth=e.Instrument=e.Part=e.Track=e.Song=e.MIDINote=e.MIDIEvent=e.getNoteData=e.getMIDIOutputsById=e.getMIDIInputsById=e.getMIDIOutputIds=e.getMIDIInputIds=e.getMIDIOutputs=e.getMIDIInputs=e.getMIDIAccess=e.setMasterVolume=e.getMasterVolume=e.getAudioContext=e.parseMIDIFile=e.parseSamples=e.MIDIEventTypes=e.getGMInstruments=e.getInstruments=e.setBufferTime=e.init=e.version=void 0;var f="1.0.0-beta21",v=function(){return M.context},y={version:f,getNoteData:t.getNoteData,init:g.init,setBufferTime:l.setBufferTime,MIDIEventTypes:d.MIDIEventTypes,parseSamples:D.parseSamples,parseMIDIFile:o.parseMIDIFile,getAudioContext:v,getMasterVolume:M.getMasterVolume,setMasterVolume:M.setMasterVolume,getMIDIAccess:m.getMIDIAccess,getMIDIInputs:m.getMIDIInputs,getMIDIOutputs:m.getMIDIOutputs,getMIDIInputIds:m.getMIDIInputIds,getMIDIOutputIds:m.getMIDIOutputIds,getMIDIInputsById:m.getMIDIInputsById,getMIDIOutputsById:m.getMIDIOutputsById,getInstruments:l.getInstruments,getGMInstruments:l.getGMInstruments,addEventListener:function(e,t){return(0,c.addEventListener)(e,t)},removeEventListener:function(e,t){(0,c.removeEventListener)(e,t)},MIDIEvent:I.MIDIEvent,MIDINote:n.MIDINote,Song:r.Song,Track:i.Track,Part:s.Part,Instrument:u.Instrument,SimpleSynth:a.SimpleSynth,Sampler:p.Sampler,log:function(e){switch(e){case"functions":console.log("functions:\n          getAudioContext\n          getMasterVolume\n          setMasterVolume\n          getMIDIAccess\n          getMIDIInputs\n          getMIDIOutputs\n          getMIDIInputIds\n          getMIDIOutputIds\n          getMIDIInputsById\n          getMIDIOutputsById\n          parseMIDIFile\n          setBufferTime\n          getInstruments\n          getGMInstruments\n        ")}}};e["default"]=y,e.version=f,e.init=g.init,e.setBufferTime=l.setBufferTime,e.getInstruments=l.getInstruments,e.getGMInstruments=l.getGMInstruments,e.MIDIEventTypes=d.MIDIEventTypes,e.parseSamples=D.parseSamples,e.parseMIDIFile=o.parseMIDIFile,e.getAudioContext=v,e.getMasterVolume=M.getMasterVolume,e.setMasterVolume=M.setMasterVolume,e.getMIDIAccess=m.getMIDIAccess,e.getMIDIInputs=m.getMIDIInputs,e.getMIDIOutputs=m.getMIDIOutputs,e.getMIDIInputIds=m.getMIDIInputIds,e.getMIDIOutputIds=m.getMIDIOutputIds,e.getMIDIInputsById=m.getMIDIInputsById,e.getMIDIOutputsById=m.getMIDIOutputsById,e.getNoteData=t.getNoteData,e.MIDIEvent=I.MIDIEvent,e.MIDINote=n.MIDINote,e.Song=r.Song,e.Track=i.Track,e.Part=s.Part,e.Instrument=u.Instrument,e.SimpleSynth=a.SimpleSynth,e.Sampler=p.Sampler});
},{"./constants":4,"./eventlistener":5,"./init":7,"./init_audio":8,"./init_midi":9,"./instrument":10,"./midi_event":12,"./midi_note":13,"./midifile":15,"./note":16,"./parse_audio":17,"./part":19,"./sampler":26,"./settings":30,"./simple_synth":31,"./song":32,"./track":35}],23:[function(require,module,exports){
!function(e,t){if("function"==typeof define&&define.amd)define(["exports","./init_audio.js","./util.js"],t);else if("undefined"!=typeof exports)t(exports,require("./init_audio.js"),require("./util.js"));else{var a={exports:{}};t(a.exports,e.init_audio,e.util),e.sample=a.exports}}(this,function(e,t,a){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,r){var i=t.context.currentTime,n=void 0,s=void 0,o=void 0;try{switch(r.releaseEnvelope){case"linear":e.gain.linearRampToValueAtTime(e.gain.value,i),e.gain.linearRampToValueAtTime(0,i+r.releaseDuration);break;case"equal power":case"equal_power":n=(0,a.getEqualPowerCurve)(100,"fadeOut",e.gain.value),e.gain.setValueCurveAtTime(n,i,r.releaseDuration);break;case"array":for(o=r.releaseEnvelopeArray.length,n=new Float32Array(o),s=0;o>s;s++)n[s]=r.releaseEnvelopeArray[s]*e.gain.value;e.gain.setValueCurveAtTime(n,i,r.releaseDuration)}}catch(u){}}Object.defineProperty(e,"__esModule",{value:!0}),e.Sample=void 0,e.fadeOut=i;var n=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}();e.Sample=function(){function e(t,a){r(this,e),this.event=a,this.sampleData=t}return n(e,[{key:"start",value:function(e){var t=this.sampleData,a=t.sustainStart,r=t.sustainEnd;a&&r&&(this.source.loop=!0,this.source.loopStart=a,this.source.loopEnd=r),this.source.start(e)}},{key:"stop",value:function(e,t){var a=this,r=this.sampleData,n=r.releaseDuration,s=r.releaseEnvelope,o=r.releaseEnvelopeArray;if(this.source.onended=t,n&&s){this.startReleasePhase=e,this.releaseFunction=function(){i(a.output,{releaseDuration:n,releaseEnvelope:s,releaseEnvelopeArray:o})};try{this.source.stop(e+n)}catch(u){}this.checkPhase()}else try{this.source.stop(e)}catch(u){}}},{key:"checkPhase",value:function(){return t.context.currentTime>=this.startReleasePhase?void this.releaseFunction():void requestAnimationFrame(this.checkPhase.bind(this))}}]),e}()});
},{"./init_audio.js":8,"./util.js":36}],24:[function(require,module,exports){
!function(e,t){if("function"==typeof define&&define.amd)define(["exports","./sample","./init_audio"],t);else if("undefined"!=typeof exports)t(exports,require("./sample"),require("./init_audio"));else{var o={exports:{}};t(o.exports,e.sample,e.init_audio),e.sample_buffer=o.exports}}(this,function(e,t,o){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(e,"__esModule",{value:!0}),e.SampleBuffer=void 0;var i=0;e.SampleBuffer=function(e){function t(e,u){n(this,t);var f=r(this,Object.getPrototypeOf(t).call(this,e,u));return f.id=f.constructor.name+"_"+i++ +"_"+(new Date).getTime(),-1===f.sampleData||"undefined"==typeof f.sampleData.buffer?f.source={start:function(){},stop:function(){},connect:function(){}}:(f.source=o.context.createBufferSource(),f.source.buffer=e.buffer),f.output=o.context.createGain(),f.volume=u.data2/127,f.output.gain.value=f.volume,f.source.connect(f.output),f}return u(t,e),t}(t.Sample)});
},{"./init_audio":8,"./sample":23}],25:[function(require,module,exports){
!function(e,t){if("function"==typeof define&&define.amd)define(["exports","./sample","./init_audio"],t);else if("undefined"!=typeof exports)t(exports,require("./sample"),require("./init_audio"));else{var o={exports:{}};t(o.exports,e.sample,e.init_audio),e.sample_oscillator=o.exports}}(this,function(e,t,o){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(e,"__esModule",{value:!0}),e.SampleOscillator=void 0;var i=0;e.SampleOscillator=function(e){function t(e,a){n(this,t);var c=r(this,Object.getPrototypeOf(t).call(this,e,a));if(c.id=c.constructor.name+"_"+i++ +"_"+(new Date).getTime(),-1===c.sampleData)c.source={start:function(){},stop:function(){},connect:function(){}};else{var s=c.sampleData.type;switch(c.source=o.context.createOscillator(),s){case"sine":case"square":case"sawtooth":case"triangle":c.source.type=s;break;default:c.source.type="square"}c.source.frequency.value=a.frequency}return c.output=o.context.createGain(),c.volume=a.data2/127,c.output.gain.value=c.volume,c.source.connect(c.output),c}return a(t,e),t}(t.Sample)});
},{"./init_audio":8,"./sample":23}],26:[function(require,module,exports){
!function(e,t){if("function"==typeof define&&define.amd)define(["exports","./instrument","./note","./parse_audio","./util","./fetch_helpers","./sample_buffer"],t);else if("undefined"!=typeof exports)t(exports,require("./instrument"),require("./note"),require("./parse_audio"),require("./util"),require("./fetch_helpers"),require("./sample_buffer"));else{var n={exports:{}};t(n.exports,e.instrument,e.note,e.parse_audio,e.util,e.fetch_helpers,e.sample_buffer),e.sampler=n.exports}}(this,function(e,t,n,r,a,o,i){"use strict";function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function f(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(e,"__esModule",{value:!0}),e.Sampler=void 0;var s=function(){function e(e,t){var n=[],r=!0,a=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(u){a=!0,o=u}finally{try{!r&&l["return"]&&l["return"]()}finally{if(a)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},c=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),y=0;e.Sampler=function(e){function t(e){l(this,t);var n=u(this,Object.getPrototypeOf(t).call(this));return n.id=n.constructor.name+"_"+y++ +"_"+(new Date).getTime(),n.name=e||n.id,n.samplesData=new Array(128).fill(-1),n.samplesData=n.samplesData.map(function(){return new Array(128).fill(-1)}),n}return f(t,e),c(t,[{key:"createSample",value:function(e){return new i.SampleBuffer(this.samplesData[e.data1][e.data2],e)}},{key:"_loadJSON",value:function(e){return"object"===("undefined"==typeof e?"undefined":p(e))&&"string"==typeof e.url?(0,o.fetchJSON)(e.url):Promise.resolve(e)}},{key:"parseSampleData",value:function(e){var t=this,n=null;return"string"==typeof e.baseUrl&&(n=e.baseUrl),"undefined"!=typeof e.release&&this.setRelease(e.release[0],e.release[1]),new Promise(function(o,i){t._loadJSON(e).then(function(a){return e=a,null!==n&&(a.baseUrl=n),"undefined"!=typeof e.release&&t.setRelease(e.release[0],e.release[1]),(0,r.parseSamples)(e)}).then(function(n){if("object"===("undefined"==typeof n?"undefined":p(n))){var r=!0,i=!1,l=void 0;try{for(var u,f=function(){var r=u.value,o=n[r],i=e[r];"undefined"==typeof i?console.log("sampleData is undefined",r):"array"===(0,a.typeString)(o)?i.forEach(function(e,n){"string"==typeof e?e={buffer:o[n]}:e.buffer=o[n],e.note=parseInt(r,10),t._updateSampleData(e)}):("string"==typeof i?i={buffer:o}:i.buffer=o,i.note=parseInt(r,10),t._updateSampleData(i))},s=Object.keys(n)[Symbol.iterator]();!(r=(u=s.next()).done);r=!0)f()}catch(c){i=!0,l=c}finally{try{!r&&s["return"]&&s["return"]()}finally{if(i)throw l}}}else n.forEach(function(n){var r=e[n];"undefined"==typeof r?console.log("sampleData is undefined",n):("string"==typeof r?r={buffer:n.buffer}:r.buffer=n.buffer,r.note=n,t._updateSampleData(r))});o()})})}},{key:"updateSampleData",value:function(){for(var e=this,t=arguments.length,n=Array(t),r=0;t>r;r++)n[r]=arguments[r];n.forEach(function(t){"array"===(0,a.typeString)(t)?t.forEach(function(t){e._updateSampleData(t)}):e._updateSampleData(t)})}},{key:"clearSampleData",value:function(){}},{key:"_updateSampleData",value:function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],r=t.note,o=t.buffer,i=void 0===o?null:o,l=t.sustain,u=void 0===l?[null,null]:l,f=t.release,p=void 0===f?[null,"linear"]:f,c=t.pan,y=void 0===c?null:c,d=t.velocity,m=void 0===d?[0,127]:d;if("undefined"==typeof r)return void console.warn("please provide a notenumber or a notename");var v=(0,n.getNoteData)({number:r});if(v===!1)return void console.warn("not a valid note id");r=v.number;var b=s(u,2),h=b[0],S=b[1],_=s(p,2),g=_[0],D=_[1],E=s(m,2),w=E[0],O=E[1];2!==u.length&&(h=S=null),null===g&&(D=null),this.samplesData[r].forEach(function(t,n){n>=w&&O>=n&&(-1===t&&(t={id:r}),t.buffer=i||t.buffer,t.sustainStart=h||t.sustainStart,t.sustainEnd=S||t.sustainEnd,t.releaseDuration=g||t.releaseDuration,t.releaseEnvelope=D||t.releaseEnvelope,t.pan=y||t.pan,"array"===(0,a.typeString)(t.releaseEnvelope)?(t.releaseEnvelopeArray=t.releaseEnvelope,t.releaseEnvelope="array"):delete t.releaseEnvelopeArray,e.samplesData[r][n]=t)})}},{key:"setKeyScalingPanning",value:function(){}},{key:"setKeyScalingRelease",value:function(){}},{key:"setRelease",value:function(e,t){this.samplesData.forEach(function(n,r){n.forEach(function(a,o){-1===a&&(a={id:r}),a.releaseDuration=e,a.releaseEnvelope=t,n[o]=a})})}}]),t}(t.Instrument)});
},{"./fetch_helpers":6,"./instrument":10,"./note":16,"./parse_audio":17,"./sample_buffer":24,"./util":36}],27:[function(require,module,exports){
!function(A,V){if("function"==typeof define&&define.amd)define(["exports"],V);else if("undefined"!=typeof exports)V(exports);else{var m={exports:{}};V(m.exports),A.samples=m.exports}}(this,function(A){"use strict";Object.defineProperty(A,"__esModule",{value:!0});var V={emptyOgg:"T2dnUwACAAAAAAAAAABdxd4XAAAAADaS0jQBHgF2b3JiaXMAAAAAAUSsAAAAAAAAgLsAAAAAAAC4AU9nZ1MAAAAAAAAAAAAAXcXeFwEAAAAaXK+QDz3/////////////////MgN2b3JiaXMtAAAAWGlwaC5PcmcgbGliVm9yYmlzIEkgMjAxMDExMDEgKFNjaGF1ZmVudWdnZXQpAAAAAAEFdm9yYmlzH0JDVgEAAAEAGGNUKUaZUtJKiRlzlDFGmWKSSomlhBZCSJ1zFFOpOdeca6y5tSCEEBpTUCkFmVKOUmkZY5ApBZlSEEtJJXQSOiedYxBbScHWmGuLQbYchA2aUkwpxJRSikIIGVOMKcWUUkpCByV0DjrmHFOOSihBuJxzq7WWlmOLqXSSSuckZExCSCmFkkoHpVNOQkg1ltZSKR1zUlJqQegghBBCtiCEDYLQkFUAAAEAwEAQGrIKAFAAABCKoRiKAoSGrAIAMgAABKAojuIojiM5kmNJFhAasgoAAAIAEAAAwHAUSZEUybEkS9IsS9NEUVV91TZVVfZ1Xdd1Xdd1IDRkFQAAAQBASKeZpRogwgxkGAgNWQUAIAAAAEYowhADQkNWAQAAAQAAYig5iCa05nxzjoNmOWgqxeZ0cCLV5kluKubmnHPOOSebc8Y455xzinJmMWgmtOaccxKDZiloJrTmnHOexOZBa6q05pxzxjmng3FGGOecc5q05kFqNtbmnHMWtKY5ai7F5pxzIuXmSW0u1eacc84555xzzjnnnHOqF6dzcE4455xzovbmWm5CF+eccz4Zp3tzQjjnnHPOOeecc84555xzgtCQVQAAEAAAQRg2hnGnIEifo4EYRYhpyKQH3aPDJGgMcgqpR6OjkVLqIJRUxkkpnSA0ZBUAAAgAACGEFFJIIYUUUkghhRRSiCGGGGLIKaecggoqqaSiijLKLLPMMssss8wy67CzzjrsMMQQQwyttBJLTbXVWGOtueecaw7SWmmttdZKKaWUUkopCA1ZBQCAAAAQCBlkkEFGIYUUUoghppxyyimooAJCQ1YBAIAAAAIAAAA8yXNER3RER3RER3RER3REx3M8R5RESZRESbRMy9RMTxVV1ZVdW9Zl3fZtYRd23fd13/d149eFYVmWZVmWZVmWZVmWZVmWZVmC0JBVAAAIAACAEEIIIYUUUkghpRhjzDHnoJNQQiA0ZBUAAAgAIAAAAMBRHMVxJEdyJMmSLEmTNEuzPM3TPE30RFEUTdNURVd0Rd20RdmUTdd0Tdl0VVm1XVm2bdnWbV+Wbd/3fd/3fd/3fd/3fd/3dR0IDVkFAEgAAOhIjqRIiqRIjuM4kiQBoSGrAAAZAAABACiKoziO40iSJEmWpEme5VmiZmqmZ3qqqAKhIasAAEAAAAEAAAAAACia4imm4imi4jmiI0qiZVqipmquKJuy67qu67qu67qu67qu67qu67qu67qu67qu67qu67qu67qu67ouEBqyCgCQAADQkRzJkRxJkRRJkRzJAUJDVgEAMgAAAgBwDMeQFMmxLEvTPM3TPE30RE/0TE8VXdEFQkNWAQCAAAACAAAAAAAwJMNSLEdzNEmUVEu1VE21VEsVVU9VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVU1TdM0TSA0ZCUAAAQAwGKNweUgISUl5d4QwhCTnjEmIbVeIQSRkt4xBhWDnjKiDHLeQuMQgx4IDVkRAEQBAADGIMcQc8g5R6mTEjnnqHSUGuccpY5SZynFmGLNKJXYUqyNc45SR62jlGIsLXaUUo2pxgIAAAIcAAACLIRCQ1YEAFEAAIQxSCmkFGKMOaecQ4wp55hzhjHmHHOOOeegdFIq55x0TkrEGHOOOaecc1I6J5VzTkonoQAAgAAHAIAAC6HQkBUBQJwAgEGSPE/yNFGUNE8URVN0XVE0XdfyPNX0TFNVPdFUVVNVbdlUVVmWPM80PdNUVc80VdVUVVk2VVWWRVXVbdN1ddt0Vd2Wbdv3XVsWdlFVbd1UXds3Vdf2Xdn2fVnWdWPyPFX1TNN1PdN0ZdV1bVt1XV33TFOWTdeVZdN1bduVZV13Zdn3NdN0XdNVZdl0Xdl2ZVe3XVn2fdN1hd+VZV9XZVkYdl33hVvXleV0Xd1XZVc3Vln2fVvXheHWdWGZPE9VPdN0Xc80XVd1XV9XXdfWNdOUZdN1bdlUXVl2Zdn3XVfWdc80Zdl0Xds2XVeWXVn2fVeWdd10XV9XZVn4VVf2dVnXleHWbeE3Xdf3VVn2hVeWdeHWdWG5dV0YPlX1fVN2heF0Zd/Xhd9Zbl04ltF1fWGVbeFYZVk5fuFYlt33lWV0XV9YbdkYVlkWhl/4neX2feN4dV0Zbt3nzLrvDMfvpPvK09VtY5l93VlmX3eO4Rg6v/Djqaqvm64rDKcsC7/t68az+76yjK7r+6osC78q28Kx677z/L6wLKPs+sJqy8Kw2rYx3L5uLL9wHMtr68ox675RtnV8X3gKw/N0dV15Zl3H9nV040c4fsoAAIABBwCAABPKQKEhKwKAOAEAjySJomRZoihZliiKpui6omi6rqRppqlpnmlammeapmmqsimarixpmmlanmaamqeZpmiarmuapqyKpinLpmrKsmmasuy6sm27rmzbomnKsmmasmyapiy7sqvbruzquqRZpql5nmlqnmeapmrKsmmarqt5nmp6nmiqniiqqmqqqq2qqixbnmeamuippieKqmqqpq2aqirLpqrasmmqtmyqqm27quz6sm3rummqsm2qpi2bqmrbruzqsizbui9pmmlqnmeamueZpmmasmyaqitbnqeaniiqquaJpmqqqiybpqrKlueZqieKquqJnmuaqirLpmraqmmatmyqqi2bpirLrm37vuvKsm6qqmybqmrrpmrKsmzLvu/Kqu6KpinLpqrasmmqsi3bsu/Lsqz7omnKsmmqsm2qqi7Lsm0bs2z7umiasm2qpi2bqirbsi37uizbuu/Krm+rqqzrsi37uu76rnDrujC8smz7qqz6uivbum/rMtv2fUTTlGVTNW3bVFVZdmXZ9mXb9n3RNG1bVVVbNk3VtmVZ9n1Ztm1hNE3ZNlVV1k3VtG1Zlm1htmXhdmXZt2Vb9nXXlXVf133j12Xd5rqy7cuyrfuqq/q27vvCcOuu8AoAABhwAAAIMKEMFBqyEgCIAgAAjGGMMQiNUs45B6FRyjnnIGTOQQghlcw5CCGUkjkHoZSUMucglJJSCKGUlFoLIZSUUmsFAAAUOAAABNigKbE4QKEhKwGAVAAAg+NYlueZomrasmNJnieKqqmqtu1IlueJommqqm1bnieKpqmqruvrmueJommqquvqumiapqmqruu6ui6aoqmqquu6sq6bpqqqriu7suzrpqqqquvKriz7wqq6rivLsm3rwrCqruvKsmzbtm/cuq7rvu/7wpGt67ou/MIxDEcBAOAJDgBABTasjnBSNBZYaMhKACADAIAwBiGDEEIGIYSQUkohpZQSAAAw4AAAEGBCGSg0ZEUAECcAABhDKaSUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJIKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKqaSUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKZVSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUgoAkIpwAJB6MKEMFBqyEgBIBQAAjFFKKcacgxAx5hhj0EkoKWLMOcYclJJS5RyEEFJpLbfKOQghpNRSbZlzUlqLMeYYM+ekpBRbzTmHUlKLseaaa+6ktFZrrjXnWlqrNdecc825tBZrrjnXnHPLMdecc8455xhzzjnnnHPOBQDgNDgAgB7YsDrCSdFYYKEhKwGAVAAAAhmlGHPOOegQUow55xyEECKFGHPOOQghVIw55xx0EEKoGHPMOQghhJA55xyEEEIIIXMOOugghBBCBx2EEEIIoZTOQQghhBBKKCGEEEIIIYQQOgghhBBCCCGEEEIIIYRSSgghhBBCCaGUUAAAYIEDAECADasjnBSNBRYashIAAAIAgByWoFLOhEGOQY8NQcpRMw1CTDnRmWJOajMVU5A5EJ10EhlqQdleMgsAAIAgACDABBAYICj4QgiIMQAAQYjMEAmFVbDAoAwaHOYBwANEhEQAkJigSLu4gC4DXNDFXQdCCEIQglgcQAEJODjhhife8IQbnKBTVOogAAAAAAAMAOABAOCgACIimquwuMDI0Njg6PAIAAAAAAAWAPgAADg+gIiI5iosLjAyNDY4OjwCAAAAAAAAAACAgIAAAAAAAEAAAACAgE9nZ1MABAEAAAAAAAAAXcXeFwIAAABq2npxAgEBAAo=",emptyMp3:"//sQxAADwAABpAAAACAAADSAAAAETEFNRTMuOTkuNVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVU=",hightick:"UklGRkQFAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YSAFAACx/xf/dADOACwBsP3p+6H+zAGoBOkCCwBX/EH5OvxlA4kJ2wcSArT9E/ut+HT2evUx98n6OAF5CCUMwQvfCOsJxAx0DSIMEAq9BiAB3vhz7mLkT9sR133YxN2s5QLv0vrUBnwRnxuQJeEsSDCiMd8yFS8aKFIhohUsCKj64u625OraA9HuyPnElcP+wxvJWtW25637VQ0jHPgnBTDDM1o0CzKLK+8hzhgFDOz8Se4J47DYVtG0z5fQq9LB12rfA+j99roHAhelIyMwIjdTOuU8mjwIOGoxhCb5E53/j+3k3/fTY8pTw4y/Tr+ew8DMvdsk8RcHRRkSKO4yGTkHPkU/rzzyNcgsrR94Dp/5r+Zs17zOncoDxhfE38WLyn/TeOMi9r0IRxlRKIQzyTlOPKo9yjmWMcokDRLc/Y7rudtdzu/D2L1Iu+27JcG3yYrVLujl+3UOZx1UK5Q0qzmNPDk8ZjeeMPojzhH+/jLtPd5m0hHLHsYIw5TEMMnA0jvj8fSOBiwXASZgMzM8dUBGQbI+rzjpKkIZygZT9QflcdaRyqXCz7+VwUPH784r3K7s+v0KDu8bvyeLMb43NjrhOIo0dSvQHi0PnP6i7ovg3NTxy4/Gf8X8yH/QBtvX55P2Ygb0FcUjsy4LNmI5ejiXM38r7iC8FJwHPvok7dDgQdaJzlTKIsoFzsrVkuA87d/6qAi7FQ0h9ClKMLEz3TOrMBcqYSD8E9AFd/dS6kTf6dbU0XnQv9IH2MXfZ+ln9DEAFwwdFy8giib6KawqeChgI/UbHBOTCZj/vvXe7InlFuDN3P3b0d1F4gzpifG2+u4D7Qw1FfwbnCD+IlgjWyHLHPMVog2mBL37qvP+7NvnYuTv4rvjfubN6k3wpPZ0/WkEOwtiEUsWcxm+Gl4aOhhiFDAPIwmbAtn7TPVy77zqcefr5YHmHull7enyfPmcAHgHew1REr8Vhhd/F+AV1RJ0DikJWQNc/ZP3efKd7hvs2ur46rHs5u8e9N/48/0hA/8HFgwuD04RSBIREqsQOg7mCssGMAJW/Xn4G/TK8Lbuzu0I7qTvnPJy9sX6bP84BLYIbAwdD84QYxG7EOcODAxwCFMEAQC9+7P3SvTX8XHw+u9R8KTxIvSo9+X7VQCUBJ0IMwziDj4QLhAGD9UMrgnTBZcBRv1v+Xv2UfS+8tfx+vES87z0+vb3+Zf9ZgEQBSEIUArWC8kM2QyzC5EJEAdvBHgBXP5n++r4Avd89Wj07fMw9D31Jvfp+Uj9xQD9A8QG5QhXClELrAsvC9wJ7gd6BWIC3v6O+7T4PPZN9EHzWvNf9Pz1Fvit+qL9rQCHAwEG/weCCZUKFwvDCnIJcAcQBWcCaf8Z/CD55vaB9dD0wPSP9UL3m/k7/Mz+JwEyAw8FzAY7CBsJaQk5CWkI2gatBCICYf+j/Fr6vfiV9872sfZP91z4p/lR+3H9zf89AroEFAfjCP0Jcwo8CjAJdQdgBSEDkgDQ/Vj7ZfnR95T28fUd9v32Vvg2+nb8+/6xAWoE4AbDCP4JpAqbCqQJ0weEBfgCTACT/R37M/m+9672IPY69gb3afhW+tT8qf+MAj0FggcuCScKXAriCcMIEAfyBJYCFwCP/Rz7A/l793z2F/Zn9mH37fjd+i39yf9pAt0EFAfRCNkJGAqrCZYIvgZPBJ8B6P4//M350vdz9q/1lfUq9mz3RPmi+3H+bgFVBOQG3wgHCkwK0Am7CCAHCgWmAjAA",lowtick:"UklGRlQFAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YTAFAAB0/5v+U/4T/3gA0wFTAuUB+f8d/nT90f1q/ub+tf46/mb/8wFQA9gC7wCd/mr+FAGRA3cE6wJf/h36evmv+8v/NwRHBZUC2/60+//5EvuZ/aX/bgFOAp8Azvzh9wfzLPF68zT4y/2BAygIfQwaEjYY0x31Irwl8SOWHVESOgPh9NfpReFt22nYHddD2BXcZeDa5InqgPDx9nP+6gS4CBYLnw0zES0WXxv4HkcgLh/1G+EX1RNpD4wKigXH/6r5/fNu7lTpj+Zu5hHoXOtL71byr/Qp91L64v6OBO4JoQ5zEskU+hU1FiQVeRP7EWgP4Qr0BIT+tPid9C3y1vCh8FDxJvK28vvyy/LA8pLzU/XP95v6xvw4/uD/RAK2BSkKcg6BEScTZBMeEqkPTQxjCKEEVwFi/nv7h/hp9aDyAvHP8MfxLvM+9PX0uPW19g/4Lfr7/C4AKgNaBXQGywb0BhIHWQfWB1oIzAjtCF8IHwdtBakDVwKLAeYA8v9w/kj81/nQ94v29/XX9bz1bPUY9Uz1Z/aH+Hr7yP4MAi4F+wcfCnYLNgyfDPsMSw0sDUAMfgrcB5IEMwFb/iX8T/pT+O/1X/Mf8cbvrO+18MLyvfVP+Rf9wgAoBCEHpwnIC5EN4Q5AD3wO1Ay0CpsIvwbvBNcCbQAr/nX8Ofsf+vb4mvda9rj1z/WX9pL3a/hH+ZX6R/wn/vP/eQESA/AE+wYDCcwKFAyPDCkMFQuSCe4HVQbSBHQDCwI8ANL9JPuY+HX28vTq82PzdPMV9Az1MfZ49zD5gftx/sQBBQXLB8cJ/gqpCw8MigwWDXENXQ2rDDUL7QgDBswCdv8S/K74WPVk8hXwou4P7mvu1+9T8pz1Uvli/ZoBwgWRCcsMPg/CEEQR4RDADwoO9wusCVMH4ARSApn/ufzd+Wj3bvX78xzzx/L68qzz1vSD9qX4Gfvd/c0AhwO/BWwHmghvCQEKVQonClsJCwiIBh0F0gOgAm0BOwAx/03+XP0g/Lb6cPmX+F/4vfh++TH6s/os+7/7cvwL/Zz9XP5O/3IA3AF9AzsF9gaUCAAKHgueCzcL9wntB3sF4wIzAI396fp1+Gv2IvWn9N30p/Xi9m74G/ru+9P9k/8aAYEC1AMTBSIG0wYuB1gHkgcACGEISAhTBzEFWAKt/5L92fuU+vX50fmf+SP5i/gb+Bf4mviv+Sr7kvyb/Uj+r/4X/8r/+gCiAo0EUAaRBzwISwjqB3IHGQfCBv8FpgTMApQAKf67+5n5/vfn9jz2yPVn9SL1RPXq9SP3Dvmr+6f+sQGKBAcH+whOCh0Laws3C28KLAmDB5AFfQNoAVP/Zv3e+7P6sfnL+Cv4vPeM95b37feV+Jn51Poq/LL9mv+YAVYD3gQuBmcHSAikCIEI7Af+BuEFngQXA1sBv/9v/pf9MP3W/Fj8q/sR+6H6U/o3+mP6y/pN+/f7xvye/WH+Jf9mAD4CQAQJBisHtgf6Bw0I8QdsB1sGywT4AggBCP/o/KX6mPg19572jfaz9uf2S/cM+E35E/tW/af/5wH1A8AFKgfkB/AHgwfxBlAGgQVIBMMCJwGs/43+vP0i/Zr8Lfzl+9H76fvi+9f75fsf/In8BP10/ej9cf4O/7f/dAAcAaUBEgKMAhgDpAMEBCEEDwTfA3IDxQL8ASoBUwCG/87+J/6h/Rr9pPxk/Gb8oPwJ/XH9w/39/UD+qP41/9D/WwDeAGsBAgKdAhEDQQNAA0sDbwOVA5YDVwPOAhgCVAGRAA=="};A["default"]=V});
},{}],28:[function(require,module,exports){
!function(t,e){if("function"==typeof define&&define.amd)define(["exports","filesaverjs"],e);else if("undefined"!=typeof exports)e(exports,require("filesaverjs"));else{var n={exports:{}};e(n.exports,t.filesaverjs),t.save_midifile=n.exports}}(this,function(t,e){"use strict";function n(t){var n=arguments.length<=1||void 0===arguments[1]?t.name:arguments[1],i=arguments.length<=2||void 0===arguments[2]?960:arguments[2];s=i,c=o(s.toString(16),2);var a=[].concat(u,h,p),d=t.getTracks(),f=d.length+1,v=void 0,l=void 0,g=void 0,m=void 0,A=void 0,y=void 0;for(a=a.concat(o(f.toString(16),2),c),a=a.concat(r(t._timeEvents,t._durationTicks,"tempo")),v=0,l=d.length;l>v;v++){g=d[v];var C=void 0;null!==g._instrument&&(C=g._instrument.id),a=a.concat(r(g._events,t._durationTicks,g.name,C))}for(l=a.length,A=new ArrayBuffer(l),y=new Uint8Array(A),v=0;l>v;v++)y[v]=a[v];m=new Blob([y],{type:"application/x-midi",endings:"transparent"}),n=n.replace(/\.midi$/,"");var _=/\.mid$/,k=_.test(n);k===!1&&(n+=".mid"),(0,e.saveAs)(m,n)}function r(t,e,n){var r,c,u,h,p,f,v=arguments.length<=3||void 0===arguments[3]?"no instrument":arguments[3],l=0,g=0,m=[];for(n&&(m.push(0),m.push(255),m.push(3),m=m.concat(i(n.length)),m=m.concat(a(n))),v&&(m.push(0),m.push(255),m.push(4),m=m.concat(i(v.length)),m=m.concat(a(v))),c=0,u=t.length;u>c;c++){if(h=t[c],g=h.ticks-l,g=i(g),m=m.concat(g),128===h.type||144===h.type)p=h.type+(h.channel||0),m.push(p),m.push(h.data1),m.push(h.data2);else if(81===h.type){m.push(255),m.push(81),m.push(3);var A=Math.round(6e7/h.bpm);m=m.concat(o(A.toString(16),3))}else if(88===h.type){var y=h.denominator;2===y?y=1:4===y?y=2:8===y?y=3:16===y?y=4:32===y&&(y=5),m.push(255),m.push(88),m.push(4),m.push(h.nominator),m.push(y),m.push(s/h.nominator),m.push(8)}l=h.ticks}return g=e-l,g=i(g),m=m.concat(g),m.push(255),m.push(47),m.push(0),f=m.length,r=o(f.toString(16),4),[].concat(d,r,m)}function o(t,e){if(e)for(;t.length/2<e;)t="0"+t;for(var n=[],r=t.length-1;r>=0;r-=2){var o=0===r?t[r]:t[r-1]+t[r];n.unshift(parseInt(o,16))}return n}function i(t){for(var e=127&t;t>>=7;)e<<=8,e|=127&t|128;for(var n=[];;){if(n.push(255&e),!(128&e))break;e>>=8}return n}function a(t){return f.map.call(t,function(t){return t.charCodeAt(0)})}Object.defineProperty(t,"__esModule",{value:!0}),t.saveAsMIDIFile=n;var s=960,c=o(s.toString(16),2),u=["M".charCodeAt(0),"T".charCodeAt(0),"h".charCodeAt(0),"d".charCodeAt(0)],h=[0,0,0,6],p=[0,1],d=["M".charCodeAt(0),"T".charCodeAt(0),"r".charCodeAt(0),"k".charCodeAt(0)],f=Array.prototype});
},{"filesaverjs":1}],29:[function(require,module,exports){
!function(t,i){if("function"==typeof define&&define.amd)define(["exports","./init_midi","./init_audio","./midi_event","./settings","./util"],i);else if("undefined"!=typeof exports)i(exports,require("./init_midi"),require("./init_audio"),require("./midi_event"),require("./settings"),require("./util"));else{var e={exports:{}};i(e.exports,t.init_midi,t.init_audio,t.midi_event,t.settings,t.util),t.scheduler=e.exports}}(this,function(t,i,e,s,n,o){"use strict";function r(t){if(Array.isArray(t)){for(var i=0,e=Array(t.length);i<t.length;i++)e[i]=t[i];return e}return Array.from(t)}function l(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function t(t,i){for(var e=0;e<i.length;e++){var s=i[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(i,e,s){return e&&t(i.prototype,e),s&&t(i,s),i}}(),h=function(){function t(i){l(this,t),this.song=i,this.notes=new Map}return a(t,[{key:"init",value:function(t){this.songCurrentMillis=t,this.songStartMillis=t,this.events=this.song._allEvents,this.numEvents=this.events.length,this.index=0,this.maxtime=0,this.prevMaxtime=0,this.beyondLoop=!1,this.precountingDone=!1,this.looped=!1,this.setIndex(this.songStartMillis)}},{key:"updateSong",value:function(){this.events=this.song._allEvents,this.numEvents=this.events.length,this.index=0,this.maxtime=0,this.setIndex(this.song._currentMillis)}},{key:"setTimeStamp",value:function(t){this.timeStamp=t}},{key:"setIndex",value:function(t){var i=0,e=void 0,s=!0,n=!1,o=void 0;try{for(var r,l=this.events[Symbol.iterator]();!(s=(r=l.next()).done);s=!0){if(e=r.value,e.millis>=t){this.index=i;break}i++}}catch(a){n=!0,o=a}finally{try{!s&&l["return"]&&l["return"]()}finally{if(n)throw o}}this.beyondLoop=t>this.song._rightLocator.millis,this.precountingDone=!1}},{key:"getEvents",value:function(){var t=[];if(this.song._loop===!0&&this.song._loopDuration<n.bufferTime&&(this.maxtime=this.songStartMillis+this.song._loopDuration-1),this.song._loop===!0)if(this.maxtime>=this.song._rightLocator.millis&&this.beyondLoop===!1){var i=this.maxtime-this.song._rightLocator.millis;if(this.maxtime=this.song._leftLocator.millis+i,this.looped===!1){this.looped=!0;for(var e=this.song._leftLocator.millis,o=this.song._rightLocator.millis,r=this.index;r<this.numEvents;r++){var l=this.events[r];if(!(l.millis<o))break;l.time=this.timeStamp+l.millis-this.songStartMillis,t.push(l),144===l.type&&this.notes.set(l.midiNoteId,l.midiNote),this.index++}var a=this.song._rightLocator.ticks-1,h=this.song.calculatePosition({type:"ticks",target:a,result:"millis"}).millis,u=!0,m=!1,d=void 0;try{for(var f,g=this.notes.values()[Symbol.iterator]();!(u=(f=g.next()).done);u=!0){var p=f.value,v=p.noteOn,c=p.noteOff;if(!(c.millis<=o)){var y=new s.MIDIEvent(a,128,v.data1,0);y.millis=h,y._part=v._part,y._track=v._track,y.midiNote=p,y.midiNoteId=p.id,y.time=this.timeStamp+y.millis-this.songStartMillis,t.push(y)}}}catch(_){m=!0,d=_}finally{try{!u&&g["return"]&&g["return"]()}finally{if(m)throw d}}this.notes=new Map,this.setIndex(e),this.timeStamp+=this.song._loopDuration,this.songCurrentMillis-=this.song._loopDuration}}else this.looped=!1;for(var x=this.index;x<this.numEvents;x++){var M=this.events[x];if(!(M.millis<this.maxtime))break;"audio"===M.type||(M.time=this.timeStamp+M.millis-this.songStartMillis,t.push(M)),this.index++}return t}},{key:"update",value:function(t){var i,e,s,o,l;if(this.prevMaxtime=this.maxtime,this.song.precounting){if(this.songCurrentMillis+=t,this.maxtime=this.songCurrentMillis+n.bufferTime,l=this.song._metronome.getPrecountEvents(this.maxtime),this.maxtime>this.song._metronome.endMillis&&this.precountingDone===!1){var a;this.precountingDone=!0,this.timeStamp+=this.song._precountDuration,this.songCurrentMillis=this.songStartMillis,this.songCurrentMillis+=t,this.maxtime=this.songCurrentMillis+n.bufferTime,(a=l).push.apply(a,r(this.getEvents()))}}else this.songCurrentMillis+=t,this.maxtime=this.songCurrentMillis+n.bufferTime,l=this.getEvents();for(s=l.length,i=0;s>i;i++)e=l[i],o=e._track,null!==e._part&&null!==o?e._part.muted!==!0&&o.muted!==!0&&e.muted!==!0&&(144!==e.type&&128!==e.type||"undefined"!=typeof e.midiNote)&&("audio"===e.type||(o.processMIDIEvent(e,!0),144===e.type?this.notes.set(e.midiNoteId,e.midiNote):128===e.type&&this.notes["delete"](e.midiNoteId))):(console.log(e),this.notes.set(e.midiNoteId,e.midiNote));return this.index>=this.numEvents}},{key:"allNotesOff",value:function(){var t=1e3*e.context.currentTime,s=(0,i.getMIDIOutputs)();s.forEach(function(i){i.send([176,123,0],t),i.send([176,121,0],t)})}}]),t}();t["default"]=h});
},{"./init_audio":8,"./init_midi":9,"./midi_event":12,"./settings":30,"./util":36}],30:[function(require,module,exports){
!function(s,e){if("function"==typeof define&&define.amd)define(["exports"],e);else if("undefined"!=typeof exports)e(exports);else{var i={exports:{}};e(i.exports),s.settings=i.exports}}(this,function(s){"use strict";function e(e){s.bufferTime=i=e}Object.defineProperty(s,"__esModule",{value:!0}),s.setBufferTime=e;var i=(s.defaultSong={ppq:960,bpm:120,bars:16,lowestNote:0,highestNote:127,nominator:4,denominator:4,quantizeValue:8,fixedLengthValue:!1,positionType:"all",useMetronome:!1,autoSize:!0,playbackSpeed:1,autoQuantize:!1},s.bufferTime=200),n=new Map([["city-piano",{name:"City Piano (piano)",description:"City Piano uses samples from a Baldwin piano, it has 4 velocity layers: 1 - 48, 49 - 96, 97 - 110 and 110 - 127. In total it uses 4 * 88 = 352 samples"}],["city-piano-light",{name:"City Piano Light (piano)",description:"City Piano light uses samples from a Baldwin piano, it has only 1 velocity layer and uses 88 samples"}],["ck-iceskates",{name:"CK Ice Skates (synth)",description:"uses Detunized samples"}],["shk2-squareroot",{name:"SHK squareroot (synth)",description:"uses Detunized samples"}],["rhodes",{name:"Rhodes (piano)",description:"uses Freesound samples"}],["rhodes2",{name:"Rhodes 2 (piano)",description:"uses Detunized samples"}],["trumpet",{name:"Trumpet (brass)",description:"uses SSO samples"}],["violin",{name:"Violin (strings)",description:"uses SSO samples"}]]),a=(s.getInstruments=function(){return n},{acoustic_grand_piano:{name:"1 Acoustic Grand Piano (piano)",description:"Fluidsynth samples"},bright_acoustic_piano:{name:"2 Bright Acoustic Piano (piano)",description:"Fluidsynth samples"},electric_grand_piano:{name:"3 Electric Grand Piano (piano)",description:"Fluidsynth samples"},honkytonk_piano:{name:"4 Honky-tonk Piano (piano)",description:"Fluidsynth samples"},electric_piano_1:{name:"5 Electric Piano 1 (piano)",description:"Fluidsynth samples"},electric_piano_2:{name:"6 Electric Piano 2 (piano)",description:"Fluidsynth samples"},harpsichord:{name:"7 Harpsichord (piano)",description:"Fluidsynth samples"},clavinet:{name:"8 Clavinet (piano)",description:"Fluidsynth samples"},celesta:{name:"9 Celesta (chromaticpercussion)",description:"Fluidsynth samples"},glockenspiel:{name:"10 Glockenspiel (chromaticpercussion)",description:"Fluidsynth samples"},music_box:{name:"11 Music Box (chromaticpercussion)",description:"Fluidsynth samples"},vibraphone:{name:"12 Vibraphone (chromaticpercussion)",description:"Fluidsynth samples"},marimba:{name:"13 Marimba (chromaticpercussion)",description:"Fluidsynth samples"},xylophone:{name:"14 Xylophone (chromaticpercussion)",description:"Fluidsynth samples"},tubular_bells:{name:"15 Tubular Bells (chromaticpercussion)",description:"Fluidsynth samples"},dulcimer:{name:"16 Dulcimer (chromaticpercussion)",description:"Fluidsynth samples"},drawbar_organ:{name:"17 Drawbar Organ (organ)",description:"Fluidsynth samples"},percussive_organ:{name:"18 Percussive Organ (organ)",description:"Fluidsynth samples"},rock_organ:{name:"19 Rock Organ (organ)",description:"Fluidsynth samples"},church_organ:{name:"20 Church Organ (organ)",description:"Fluidsynth samples"},reed_organ:{name:"21 Reed Organ (organ)",description:"Fluidsynth samples"},accordion:{name:"22 Accordion (organ)",description:"Fluidsynth samples"},harmonica:{name:"23 Harmonica (organ)",description:"Fluidsynth samples"},tango_accordion:{name:"24 Tango Accordion (organ)",description:"Fluidsynth samples"},acoustic_guitar_nylon:{name:"25 Acoustic Guitar (nylon) (guitar)",description:"Fluidsynth samples"},acoustic_guitar_steel:{name:"26 Acoustic Guitar (steel) (guitar)",description:"Fluidsynth samples"},electric_guitar_jazz:{name:"27 Electric Guitar (jazz) (guitar)",description:"Fluidsynth samples"},electric_guitar_clean:{name:"28 Electric Guitar (clean) (guitar)",description:"Fluidsynth samples"},electric_guitar_muted:{name:"29 Electric Guitar (muted) (guitar)",description:"Fluidsynth samples"},overdriven_guitar:{name:"30 Overdriven Guitar (guitar)",description:"Fluidsynth samples"},distortion_guitar:{name:"31 Distortion Guitar (guitar)",description:"Fluidsynth samples"},guitar_harmonics:{name:"32 Guitar Harmonics (guitar)",description:"Fluidsynth samples"},acoustic_bass:{name:"33 Acoustic Bass (bass)",description:"Fluidsynth samples"},electric_bass_finger:{name:"34 Electric Bass (finger) (bass)",description:"Fluidsynth samples"},electric_bass_pick:{name:"35 Electric Bass (pick) (bass)",description:"Fluidsynth samples"},fretless_bass:{name:"36 Fretless Bass (bass)",description:"Fluidsynth samples"},slap_bass_1:{name:"37 Slap Bass 1 (bass)",description:"Fluidsynth samples"},slap_bass_2:{name:"38 Slap Bass 2 (bass)",description:"Fluidsynth samples"},synth_bass_1:{name:"39 Synth Bass 1 (bass)",description:"Fluidsynth samples"},synth_bass_2:{name:"40 Synth Bass 2 (bass)",description:"Fluidsynth samples"},violin:{name:"41 Violin (strings)",description:"Fluidsynth samples"},viola:{name:"42 Viola (strings)",description:"Fluidsynth samples"},cello:{name:"43 Cello (strings)",description:"Fluidsynth samples"},contrabass:{name:"44 Contrabass (strings)",description:"Fluidsynth samples"},tremolo_strings:{name:"45 Tremolo Strings (strings)",description:"Fluidsynth samples"},pizzicato_strings:{name:"46 Pizzicato Strings (strings)",description:"Fluidsynth samples"},orchestral_harp:{name:"47 Orchestral Harp (strings)",description:"Fluidsynth samples"},timpani:{name:"48 Timpani (strings)",description:"Fluidsynth samples"},string_ensemble_1:{name:"49 String Ensemble 1 (ensemble)",description:"Fluidsynth samples"},string_ensemble_2:{name:"50 String Ensemble 2 (ensemble)",description:"Fluidsynth samples"},synth_strings_1:{name:"51 Synth Strings 1 (ensemble)",description:"Fluidsynth samples"},synth_strings_2:{name:"52 Synth Strings 2 (ensemble)",description:"Fluidsynth samples"},choir_aahs:{name:"53 Choir Aahs (ensemble)",description:"Fluidsynth samples"},voice_oohs:{name:"54 Voice Oohs (ensemble)",description:"Fluidsynth samples"},synth_choir:{name:"55 Synth Choir (ensemble)",description:"Fluidsynth samples"},orchestra_hit:{name:"56 Orchestra Hit (ensemble)",description:"Fluidsynth samples"},trumpet:{name:"57 Trumpet (brass)",description:"Fluidsynth samples"},trombone:{name:"58 Trombone (brass)",description:"Fluidsynth samples"},tuba:{name:"59 Tuba (brass)",description:"Fluidsynth samples"},muted_trumpet:{name:"60 Muted Trumpet (brass)",description:"Fluidsynth samples"},french_horn:{name:"61 French Horn (brass)",description:"Fluidsynth samples"},brass_section:{name:"62 Brass Section (brass)",description:"Fluidsynth samples"},synth_brass_1:{name:"63 Synth Brass 1 (brass)",description:"Fluidsynth samples"},synth_brass_2:{name:"64 Synth Brass 2 (brass)",description:"Fluidsynth samples"},soprano_sax:{name:"65 Soprano Sax (reed)",description:"Fluidsynth samples"},alto_sax:{name:"66 Alto Sax (reed)",description:"Fluidsynth samples"},tenor_sax:{name:"67 Tenor Sax (reed)",description:"Fluidsynth samples"},baritone_sax:{name:"68 Baritone Sax (reed)",description:"Fluidsynth samples"},oboe:{name:"69 Oboe (reed)",description:"Fluidsynth samples"},english_horn:{name:"70 English Horn (reed)",description:"Fluidsynth samples"},bassoon:{name:"71 Bassoon (reed)",description:"Fluidsynth samples"},clarinet:{name:"72 Clarinet (reed)",description:"Fluidsynth samples"},piccolo:{name:"73 Piccolo (pipe)",description:"Fluidsynth samples"},flute:{name:"74 Flute (pipe)",description:"Fluidsynth samples"},recorder:{name:"75 Recorder (pipe)",description:"Fluidsynth samples"},pan_flute:{name:"76 Pan Flute (pipe)",description:"Fluidsynth samples"},blown_bottle:{name:"77 Blown Bottle (pipe)",description:"Fluidsynth samples"},shakuhachi:{name:"78 Shakuhachi (pipe)",description:"Fluidsynth samples"},whistle:{name:"79 Whistle (pipe)",description:"Fluidsynth samples"},ocarina:{name:"80 Ocarina (pipe)",description:"Fluidsynth samples"},lead_1_square:{name:"81 Lead 1 (square) (synthlead)",description:"Fluidsynth samples"},lead_2_sawtooth:{name:"82 Lead 2 (sawtooth) (synthlead)",description:"Fluidsynth samples"},lead_3_calliope:{name:"83 Lead 3 (calliope) (synthlead)",description:"Fluidsynth samples"},lead_4_chiff:{name:"84 Lead 4 (chiff) (synthlead)",description:"Fluidsynth samples"},lead_5_charang:{name:"85 Lead 5 (charang) (synthlead)",description:"Fluidsynth samples"},lead_6_voice:{name:"86 Lead 6 (voice) (synthlead)",description:"Fluidsynth samples"},lead_7_fifths:{name:"87 Lead 7 (fifths) (synthlead)",description:"Fluidsynth samples"},lead_8_bass__lead:{name:"88 Lead 8 (bass + lead) (synthlead)",description:"Fluidsynth samples"},pad_1_new_age:{name:"89 Pad 1 (new age) (synthpad)",description:"Fluidsynth samples"},pad_2_warm:{name:"90 Pad 2 (warm) (synthpad)",description:"Fluidsynth samples"},pad_3_polysynth:{name:"91 Pad 3 (polysynth) (synthpad)",description:"Fluidsynth samples"},pad_4_choir:{name:"92 Pad 4 (choir) (synthpad)",description:"Fluidsynth samples"},pad_5_bowed:{name:"93 Pad 5 (bowed) (synthpad)",description:"Fluidsynth samples"},pad_6_metallic:{name:"94 Pad 6 (metallic) (synthpad)",description:"Fluidsynth samples"},pad_7_halo:{name:"95 Pad 7 (halo) (synthpad)",description:"Fluidsynth samples"},pad_8_sweep:{name:"96 Pad 8 (sweep) (synthpad)",description:"Fluidsynth samples"},fx_1_rain:{name:"97 FX 1 (rain) (syntheffects)",description:"Fluidsynth samples"},fx_2_soundtrack:{name:"98 FX 2 (soundtrack) (syntheffects)",description:"Fluidsynth samples"},fx_3_crystal:{name:"99 FX 3 (crystal) (syntheffects)",description:"Fluidsynth samples"},fx_4_atmosphere:{name:"100 FX 4 (atmosphere) (syntheffects)",description:"Fluidsynth samples"},fx_5_brightness:{name:"101 FX 5 (brightness) (syntheffects)",description:"Fluidsynth samples"},fx_6_goblins:{name:"102 FX 6 (goblins) (syntheffects)",description:"Fluidsynth samples"},fx_7_echoes:{name:"103 FX 7 (echoes) (syntheffects)",description:"Fluidsynth samples"},fx_8_scifi:{name:"104 FX 8 (sci-fi) (syntheffects)",description:"Fluidsynth samples"},sitar:{name:"105 Sitar (ethnic)",description:"Fluidsynth samples"},banjo:{name:"106 Banjo (ethnic)",description:"Fluidsynth samples"},shamisen:{name:"107 Shamisen (ethnic)",description:"Fluidsynth samples"},koto:{name:"108 Koto (ethnic)",description:"Fluidsynth samples"},kalimba:{name:"109 Kalimba (ethnic)",description:"Fluidsynth samples"},bagpipe:{name:"110 Bagpipe (ethnic)",description:"Fluidsynth samples"},fiddle:{name:"111 Fiddle (ethnic)",description:"Fluidsynth samples"},shanai:{name:"112 Shanai (ethnic)",description:"Fluidsynth samples"},tinkle_bell:{name:"113 Tinkle Bell (percussive)",description:"Fluidsynth samples"},agogo:{name:"114 Agogo (percussive)",description:"Fluidsynth samples"},steel_drums:{name:"115 Steel Drums (percussive)",description:"Fluidsynth samples"},woodblock:{name:"116 Woodblock (percussive)",description:"Fluidsynth samples"},taiko_drum:{name:"117 Taiko Drum (percussive)",description:"Fluidsynth samples"},melodic_tom:{name:"118 Melodic Tom (percussive)",description:"Fluidsynth samples"},synth_drum:{name:"119 Synth Drum (percussive)",description:"Fluidsynth samples"},reverse_cymbal:{name:"120 Reverse Cymbal (soundeffects)",description:"Fluidsynth samples"},guitar_fret_noise:{name:"121 Guitar Fret Noise (soundeffects)",description:"Fluidsynth samples"},breath_noise:{name:"122 Breath Noise (soundeffects)",description:"Fluidsynth samples"},seashore:{name:"123 Seashore (soundeffects)",description:"Fluidsynth samples"},bird_tweet:{name:"124 Bird Tweet (soundeffects)",description:"Fluidsynth samples"},telephone_ring:{name:"125 Telephone Ring (soundeffects)",description:"Fluidsynth samples"},helicopter:{name:"126 Helicopter (soundeffects)",description:"Fluidsynth samples"},applause:{name:"127 Applause (soundeffects)",description:"Fluidsynth samples"},gunshot:{name:"128 Gunshot (soundeffects)",description:"Fluidsynth samples"}}),t=new Map;Object.keys(a).forEach(function(s){t.set(s,a[s])});s.getGMInstruments=function(){return t},s.noteNameMode="sharp",s.pitch=440});
},{}],31:[function(require,module,exports){
!function(e,t){if("function"==typeof define&&define.amd)define(["exports","./instrument","./sample_oscillator"],t);else if("undefined"!=typeof exports)t(exports,require("./instrument"),require("./sample_oscillator"));else{var n={exports:{}};t(n.exports,e.instrument,e.sample_oscillator),e.simple_synth=n.exports}}(this,function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(e,"__esModule",{value:!0}),e.SimpleSynth=void 0;var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=0;e.SimpleSynth=function(e){function t(e,n){r(this,t);var i=o(this,Object.getPrototypeOf(t).call(this));return i.id=i.constructor.name+"_"+l++ +"_"+(new Date).getTime(),i.name=n||i.id,i.type=e,i.sampleData={type:e,releaseDuration:.2,releaseEnvelope:"equal power"},i}return i(t,e),a(t,[{key:"createSample",value:function(e){return new n.SampleOscillator(this.sampleData,e)}},{key:"setKeyScalingPanning",value:function(){}},{key:"setKeyScalingRelease",value:function(){}},{key:"setRelease",value:function(e,t){this.sampleData.releaseDuration=e,this.sampleData.releaseEnvelope=t}}]),t}(t.Instrument)});
},{"./instrument":10,"./sample_oscillator":25}],32:[function(require,module,exports){
!function(t,e){if("function"==typeof define&&define.amd)define(["exports","./constants","./parse_events","./init_audio","./scheduler","./midi_event","./song_from_midifile","./util","./position","./playhead","./metronome","./eventlistener","./settings","./save_midifile","./song.update"],e);else if("undefined"!=typeof exports)e(exports,require("./constants"),require("./parse_events"),require("./init_audio"),require("./scheduler"),require("./midi_event"),require("./song_from_midifile"),require("./util"),require("./position"),require("./playhead"),require("./metronome"),require("./eventlistener"),require("./settings"),require("./save_midifile"),require("./song.update"));else{var i={exports:{}};e(i.exports,t.constants,t.parse_events,t.init_audio,t.scheduler,t.midi_event,t.song_from_midifile,t.util,t.position,t.playhead,t.metronome,t.eventlistener,t.settings,t.save_midifile,t.song),t.song=i.exports}}(this,function(t,e,i,s,n,r,o,a,l,u,h,c,d,p,_){"use strict";function v(t){return t&&t.__esModule?t:{"default":t}}function f(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}function g(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.Song=void 0;var m=v(n),y=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),k=0,M=0;t.Song=function(){function t(){var i=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];g(this,t),this.id=this.constructor.name+"_"+k++ +"_"+(new Date).getTime();var n=i.name;this.name=void 0===n?this.id:n;var o=i.ppq;this.ppq=void 0===o?d.defaultSong.ppq:o;var a=i.bpm;this.bpm=void 0===a?d.defaultSong.bpm:a;var l=i.bars;this.bars=void 0===l?d.defaultSong.bars:l;var c=i.nominator;this.nominator=void 0===c?d.defaultSong.nominator:c;var p=i.denominator;this.denominator=void 0===p?d.defaultSong.denominator:p;var _=i.quantizeValue;this.quantizeValue=void 0===_?d.defaultSong.quantizeValue:_;var v=i.fixedLengthValue;this.fixedLengthValue=void 0===v?d.defaultSong.fixedLengthValue:v;var f=i.useMetronome;this.useMetronome=void 0===f?d.defaultSong.useMetronome:f;var y=i.autoSize;this.autoSize=void 0===y?d.defaultSong.autoSize:y;var M=i.playbackSpeed;this.playbackSpeed=void 0===M?d.defaultSong.playbackSpeed:M;var E=i.autoQuantize;this.autoQuantize=void 0===E?d.defaultSong.autoQuantize:E,this._timeEvents=[new r.MIDIEvent(0,e.MIDIEventTypes.TEMPO,this.bpm),new r.MIDIEvent(0,e.MIDIEventTypes.TIME_SIGNATURE,this.nominator,this.denominator)],this._updateTimeEvents=!0,this._lastEvent=new r.MIDIEvent(0,e.MIDIEventTypes.END_OF_TRACK),this._tracks=[],this._tracksById=new Map,this._parts=[],this._partsById=new Map,this._events=[],this._eventsById=new Map,this._allEvents=[],this._notes=[],this._notesById=new Map,this._newEvents=[],this._movedEvents=[],this._removedEvents=[],this._transposedEvents=[],this._newParts=[],this._changedParts=[],this._removedParts=[],this._currentMillis=0,this._scheduler=new m["default"](this),this._playhead=new u.Playhead(this),this.playing=!1,this.paused=!1,this.recording=!1,this.precounting=!1,this.stopped=!0,this.looping=!1,this.volume=.5,this._output=s.context.createGain(),this._output.gain.value=this.volume,this._output.connect(s.masterGain),this._metronome=new h.Metronome(this),this._metronomeEvents=[],this._updateMetronomeEvents=!0,this._metronome.mute(!this.useMetronome),this._loop=!1,this._leftLocator={millis:0,ticks:0},this._rightLocator={millis:0,ticks:0},this._illegalLoop=!1,this._loopDuration=0,this._precountBars=0,this._endPrecountMillis=0,this.update()}return y(t,null,[{key:"fromMIDIFile",value:function(t){return(0,o.songFromMIDIFile)(t)}},{key:"fromMIDIFileSync",value:function(t){return(0,o.songFromMIDIFileSync)(t)}}]),y(t,[{key:"addTimeEvents",value:function(){for(var t=this,i=arguments.length,s=Array(i),n=0;i>n;n++)s[n]=arguments[n];s.forEach(function(i){i.type===e.MIDIEventTypes.TIME_SIGNATURE&&(t._updateMetronomeEvents=!0),t._timeEvents.push(i)}),this._updateTimeEvents=!0}},{key:"addTracks",value:function(){for(var t=this,e=arguments.length,i=Array(e),s=0;e>s;s++)i[s]=arguments[s];i.forEach(function(e){var i,s;e._song=t,e.connect(t._output),t._tracks.push(e),t._tracksById.set(e.id,e),(i=t._newEvents).push.apply(i,f(e._events)),(s=t._newParts).push.apply(s,f(e._parts))})}},{key:"update",value:function(){_.update.call(this)}},{key:"play",value:function(t){for(var e=arguments.length,i=Array(e>1?e-1:0),s=1;e>s;s++)i[s-1]=arguments[s];this._play.apply(this,[t].concat(i)),this._precountBars>0?(0,c.dispatchEvent)({type:"precounting",data:this._currentMillis}):this._preparedForRecording===!0?(0,c.dispatchEvent)({type:"start_recording",data:this._currentMillis}):(0,c.dispatchEvent)({type:"play",data:this._currentMillis})}},{key:"_play",value:function(t){if("undefined"!=typeof t){for(var e=arguments.length,i=Array(e>1?e-1:0),n=1;e>n;n++)i[n-1]=arguments[n];this.setPosition.apply(this,[t].concat(i))}if(!this.playing){if(this._reference=this._timeStamp=1e3*s.context.currentTime,this._scheduler.setTimeStamp(this._reference),this._startMillis=this._currentMillis,this._precountBars>0&&this._preparedForRecording){var r=this.getPosition();this._metronome.createPrecountEvents(r.bar,r.bar+this._precountBars,this._reference),this._currentMillis=this._calculatePosition("barsbeats",[r.bar],"millis").millis,this._precountDuration=this._metronome.precountDuration,this._endPrecountMillis=this._currentMillis+this._precountDuration,this.precounting=!0}else this._endPrecountMillis=0,this.playing=!0,this.recording=this._preparedForRecording;this.paused&&(this.paused=!1),this._playhead.set("millis",this._currentMillis),this._scheduler.init(this._currentMillis),this._loop=this.looping&&this._currentMillis<=this._rightLocator.millis,this._pulse()}}},{key:"_pulse",value:function(){if(this.playing!==!1||this.precounting!==!1){this._performUpdate===!0&&(this._performUpdate=!1,_._update.call(this));var t=1e3*s.context.currentTime,e=t-this._reference;if(this._currentMillis+=e,this._reference=t,this._endPrecountMillis>0){if(this._endPrecountMillis>this._currentMillis)return this._scheduler.update(e),void requestAnimationFrame(this._pulse.bind(this));this.precounting=!1,this._endPrecountMillis=0,this._currentMillis-=this._precountDuration,this._preparedForRecording?(this.playing=!0,this.recording=!0):(this.playing=!0,(0,c.dispatchEvent)({type:"play",data:this._startMillis}))}if(this._loop&&this._currentMillis>=this._rightLocator.millis?(this._currentMillis-=this._loopDuration,this._playhead.set("millis",this._currentMillis),(0,c.dispatchEvent)({type:"loop",data:null})):this._playhead.update("millis",e),this._ticks=this._playhead.get().ticks,this._currentMillis>=this._durationMillis){var n;if(this.recording!==!0||this.autoSize!==!0)return void this.stop();var r=this._metronome.addEvents(this.bars,this.bars+1),o=[].concat(f(r),f(this._timeEvents));(0,a.sortEvents)(o),(0,i.parseEvents)(o),(n=this._scheduler.events).push.apply(n,f(r)),this._scheduler.numEvents+=r.length;var l=r[r.length-1],u=l.ticksPerBar*l.millisPerTick;this._lastEvent.ticks+=l.ticksPerBar,this._lastEvent.millis+=u,this._durationMillis+=u,this.bars++,this._resized=!0}this._scheduler.update(e),requestAnimationFrame(this._pulse.bind(this))}}},{key:"pause",value:function(){this.paused=!this.paused,this.precounting=!1,this.paused?(this.playing=!1,this.allNotesOff(),(0,c.dispatchEvent)({type:"pause",data:this.paused})):(this.play(),(0,c.dispatchEvent)({type:"pause",data:this.paused}))}},{key:"stop",value:function(){this.precounting=!1,this.allNotesOff(),(this.playing||this.paused)&&(this.playing=!1,this.paused=!1),0!==this._currentMillis&&(this._currentMillis=0,this._playhead.set("millis",this._currentMillis),this.recording&&this.stopRecording(),(0,c.dispatchEvent)({type:"stop"}))}},{key:"startRecording",value:function(){var t=this;this._preparedForRecording!==!0&&(this._recordId="recording_"+M++ +(new Date).getTime(),this._tracks.forEach(function(e){e._startRecording(t._recordId)}),this._preparedForRecording=!0)}},{key:"stopRecording",value:function(){var t=this;this._preparedForRecording!==!1&&(this._tracks.forEach(function(e){e._stopRecording(t._recordId)}),this.update(),this._preparedForRecording=!1,this.recording=!1,(0,c.dispatchEvent)({type:"stop_recording"}))}},{key:"undoRecording",value:function(){var t=this;this._tracks.forEach(function(e){e.undoRecording(t._recordId)}),this.update()}},{key:"redoRecording",value:function(){var t=this;this._tracks.forEach(function(e){e.redoRecording(t._recordId)}),this.update()}},{key:"setMetronome",value:function(t){"undefined"==typeof t?this.useMetronome=!this.useMetronome:this.useMetronome=t,this._metronome.mute(!this.useMetronome)}},{key:"configureMetronome",value:function(t){this._metronome.configure(t)}},{key:"configure",value:function(t){}},{key:"allNotesOff",value:function(){this._tracks.forEach(function(t){t.allNotesOff()}),this._scheduler.allNotesOff(),this._metronome.allNotesOff()}},{key:"panic",value:function(){var t=this;return new Promise(function(e){t._tracks.forEach(function(e){e.disconnect(t._output)}),setTimeout(function(){t._tracks.forEach(function(e){e.connect(t._output)}),e()},100)})}},{key:"getTracks",value:function(){return[].concat(f(this._tracks))}},{key:"getParts",value:function(){return[].concat(f(this._parts))}},{key:"getEvents",value:function(){return[].concat(f(this._events))}},{key:"getNotes",value:function(){return[].concat(f(this._notes))}},{key:"calculatePosition",value:function(t){return(0,l.calculatePosition)(this,t)}},{key:"setPosition",value:function(t){var e=this.playing;this.playing&&(this.playing=!1,this.allNotesOff());for(var i=arguments.length,s=Array(i>1?i-1:0),n=1;i>n;n++)s[n-1]=arguments[n];var r=this._calculatePosition(t,s,"all");r!==!1&&(this._currentMillis=r.millis,(0,c.dispatchEvent)({type:"position",data:r}),e?this._play():this._playhead.set("millis",this._currentMillis))}},{key:"getPosition",value:function(){return this._playhead.get().position}},{key:"getPlayhead",value:function(){return this._playhead.get()}},{key:"setLeftLocator",value:function(t){for(var e=arguments.length,i=Array(e>1?e-1:0),s=1;e>s;s++)i[s-1]=arguments[s];return this._leftLocator=this._calculatePosition(t,i,"all"),this._leftLocator===!1?(console.warn("invalid position for locator"),void(this._leftLocator={millis:0,ticks:0})):void 0}},{key:"setRightLocator",value:function(t){for(var e=arguments.length,i=Array(e>1?e-1:0),s=1;e>s;s++)i[s-1]=arguments[s];return this._rightLocator=this._calculatePosition(t,i,"all"),this._rightLocator===!1?(this._rightLocator={millis:0,ticks:0},void console.warn("invalid position for locator")):void 0}},{key:"setLoop",value:function(){var t=arguments.length<=0||void 0===arguments[0]?null:arguments[0];return this.looping=null!==t?t:!this._loop,this._rightLocator===!1||this._leftLocator===!1?(this._illegalLoop=!0,this._loop=!1,this.looping=!1,!1):this._rightLocator.millis<=this._leftLocator.millis?(this._illegalLoop=!0,this._loop=!1,this.looping=!1,!1):(this._loopDuration=this._rightLocator.millis-this._leftLocator.millis,this._scheduler.beyondLoop=this._currentMillis>this._rightLocator.millis,this._loop=this.looping&&this._currentMillis<=this._rightLocator.millis,this.looping)}},{key:"setPrecount",value:function(){var t=arguments.length<=0||void 0===arguments[0]?0:arguments[0];this._precountBars=t}},{key:"_calculatePosition",value:function(t,e,i){var s=void 0;switch(t){case"ticks":case"millis":case"percentage":s=e||0;break;case"time":case"barsbeats":case"barsandbeats":s=e;break;default:return console.log("unsupported type"),!1}var n=(0,l.calculatePosition)(this,{type:t,target:s,result:i});return n}},{key:"addEventListener",value:function(t,e){return(0,c.addEventListener)(t,e)}},{key:"removeEventListener",value:function(t,e){(0,c.removeEventListener)(t,e)}},{key:"saveAsMIDIFile",value:function(t){(0,p.saveAsMIDIFile)(this,t)}},{key:"setVolume",value:function(t){return 0>t||t>1?void console.log("Song.setVolume() accepts a value between 0 and 1, you entered:",t):void(this.volume=t)}},{key:"getVolume",value:function(){return this.volume}},{key:"setPanning",value:function(t){return-1>t||t>1?void console.log("Song.setPanning() accepts a value between -1 (full left) and 1 (full right), you entered:",t):(this._tracks.forEach(function(e){e.setPanning(t)}),void(this._pannerValue=t))}}]),t}()});
},{"./constants":4,"./eventlistener":5,"./init_audio":8,"./metronome":11,"./midi_event":12,"./parse_events":18,"./playhead":20,"./position":21,"./save_midifile":28,"./scheduler":29,"./settings":30,"./song.update":33,"./song_from_midifile":34,"./util":36}],33:[function(require,module,exports){
!function(t,e){if("function"==typeof define&&define.amd)define(["exports","./parse_events","./util","./constants","./position","./midi_event","./eventlistener","./settings"],e);else if("undefined"!=typeof exports)e(exports,require("./parse_events"),require("./util"),require("./constants"),require("./position"),require("./midi_event"),require("./eventlistener"),require("./settings"));else{var s={exports:{}};e(s.exports,t.parse_events,t.util,t.constants,t.position,t.midi_event,t.eventlistener,t.settings),t.songUpdate=s.exports}}(this,function(t,e,s,i,n,r,o,a){"use strict";function h(t){if(Array.isArray(t)){for(var e=0,s=Array(t.length);e<t.length;e++)s[e]=t[e];return s}return Array.from(t)}function _(){this.playing===!1?v.call(this):this._performUpdate=!0}function v(){var t=this;if(this._updateTimeEvents!==!1||0!==this._removedEvents.length||0!==this._newEvents.length||0!==this._movedEvents.length||0!==this._newParts.length||0!==this._removedParts.length||this._resized!==!1){console.time("updating song took"),this._updateTimeEvents===!0&&((0,e.parseTimeEvents)(this,this._timeEvents,this.isPlaying),this._updateTimeEvents=!1);var a=[];this._removedParts.forEach(function(e){t._partsById["delete"](e.id)}),this._newParts.forEach(function(e){e._song=t,t._partsById.set(e.id,e),e.update()}),this._changedParts.forEach(function(t){t.update()}),this._removedParts.forEach(function(e){t._partsById["delete"](e.id)}),this._removedParts.length>0&&(this._parts=Array.from(this._partsById.values())),this._removedEvents.forEach(function(e){var s=e.midiNote._track;e.time>=t._currentMillis&&s.unschedule(e),t._notesById["delete"](e.midiNote.id),t._eventsById["delete"](e.id)}),this._newEvents.forEach(function(e){t._eventsById.set(e.id,e),t._events.push(e),a.push(e)}),this._movedEvents.forEach(function(t){a.push(t)}),a.length>0&&(a=[].concat(h(a),h(this._timeEvents)),(0,e.parseEvents)(a,this.isPlaying),a.forEach(function(e){e.type===i.MIDIEventTypes.NOTE_ON&&e.midiNote&&t._notesById.set(e.midiNoteId,e.midiNote)})),(a.length>0||this._removedEvents.length>0)&&(this._events=Array.from(this._eventsById.values()),this._notes=Array.from(this._notesById.values())),(0,s.sortEvents)(this._events),this._notes.sort(function(t,e){return t.noteOn.ticks-e.noteOn.ticks}),console.timeEnd("updating song took");var _=this._events[this._events.length-1],v=this._timeEvents[this._timeEvents.length-1];_ instanceof r.MIDIEvent==!1?_=v:v.ticks>_.ticks&&(_=v),this.bars=Math.max(_.bar,this.bars);var d=(0,n.calculatePosition)(this,{type:"barsbeats",target:[this.bars+1],result:"ticks"}).ticks,l=(0,n.calculatePosition)(this,{type:"ticks",target:d-1,result:"millis"}).millis;this._lastEvent.ticks=d-1,this._lastEvent.millis=l,this._durationTicks=this._lastEvent.ticks,this._durationMillis=this._lastEvent.millis,(this._updateMetronomeEvents||this._metronome.bars!==this.bars)&&(this._metronomeEvents=(0,e.parseEvents)([].concat(h(this._timeEvents),h(this._metronome.getEvents())))),this._allEvents=[].concat(h(this._metronomeEvents),h(this._events)),(0,s.sortEvents)(this._allEvents),this._playhead.updateSong(),this._scheduler.updateSong(),this.playing===!1&&(this._playhead.set("millis",this._currentMillis),(0,o.dispatchEvent)({type:"position",data:this._playhead.get().position})),this._newParts=[],this._removedParts=[],this._newEvents=[],this._movedEvents=[],this._removedEvents=[],this._resized=!1}}Object.defineProperty(t,"__esModule",{value:!0}),t.update=_,t._update=v});
},{"./constants":4,"./eventlistener":5,"./midi_event":12,"./parse_events":18,"./position":21,"./settings":30,"./util":36}],34:[function(require,module,exports){
!function(e,r){if("function"==typeof define&&define.amd)define(["exports","isomorphic-fetch","./midifile","./midi_event","./part","./track","./song","./util","./fetch_helpers"],r);else if("undefined"!=typeof exports)r(exports,require("isomorphic-fetch"),require("./midifile"),require("./midi_event"),require("./part"),require("./track"),require("./song"),require("./util"),require("./fetch_helpers"));else{var t={exports:{}};r(t.exports,e.isomorphicFetch,e.midifile,e.midi_event,e.part,e.track,e.song,e.util,e.fetch_helpers),e.song_from_midifile=t.exports}}(this,function(e,r,t,n,a,i,o,s,u){"use strict";function c(e){return e&&e.__esModule?e:{"default":e}}function f(e){var r=e.tracks,t=e.header.ticksPerBeat,s=v/t,u=[],c=-1,f=-1,l=-1,d=[],p=!0,m=!1,h=void 0;try{for(var y,I=r.values()[Symbol.iterator]();!(p=(y=I.next()).done);p=!0){var b=y.value,k=void 0,w=void 0,g=0,M=void 0,_=-1,x=void 0,D=void 0,q=[],E=!0,B=!1,F=void 0;try{for(var T,P=b[Symbol.iterator]();!(E=(T=P.next()).done);E=!0){var S=T.value;switch(g+=S.deltaTime*s,-1===_&&"undefined"!=typeof S.channel&&(_=S.channel),M=S.subtype,S.subtype){case"trackName":x=S.text;break;case"instrumentName":S.text&&(D=S.text);break;case"noteOn":q.push(new n.MIDIEvent(g,144,S.noteNumber,S.velocity));break;case"noteOff":q.push(new n.MIDIEvent(g,128,S.noteNumber,S.velocity));break;case"setTempo":var N=6e7/S.microsecondsPerBeat;g===k&&M===w&&u.pop(),-1===c&&(c=N),u.push(new n.MIDIEvent(g,81,N));break;case"timeSignature":k===g&&w===M&&(console.info("time signature events on the same tick",g,S.numerator,S.denominator),u.pop()),-1===f&&(f=S.numerator,l=S.denominator),u.push(new n.MIDIEvent(g,88,S.numerator,S.denominator));break;case"controller":q.push(new n.MIDIEvent(g,176,S.controllerType,S.value));break;case"programChange":q.push(new n.MIDIEvent(g,192,S.programNumber));break;case"pitchBend":q.push(new n.MIDIEvent(g,224,S.value))}w=M,k=g}}catch(A){B=!0,F=A}finally{try{!E&&P["return"]&&P["return"]()}finally{if(B)throw F}}if(q.length>0){var O=new i.Track(x),U=new a.Part;O.addParts(U),U.addEvents.apply(U,q),d.push(O)}}}catch(A){m=!0,h=A}finally{try{!p&&I["return"]&&I["return"]()}finally{if(m)throw h}}var j=new o.Song({ppq:v,playbackSpeed:1,bpm:c,nominator:f,denominator:l});return j.addTracks.apply(j,d),j.addTimeEvents.apply(j,u),j.update(),j}function l(e){var r=(arguments.length<=1||void 0===arguments[1]?{}:arguments[1],null);if(e instanceof ArrayBuffer==!0){var n=new Uint8Array(e);r=f((0,t.parseMIDIFile)(n))}else if("undefined"!=typeof e.header&&"undefined"!=typeof e.tracks)r=f(e);else if(e=(0,s.base64ToBinary)(e),e instanceof ArrayBuffer==!0){var a=new Uint8Array(e);r=f((0,t.parseMIDIFile)(a))}else console.error("wrong data");return r}function d(e){return new Promise(function(r,t){(0,p["default"])(e).then(u.status).then(u.arrayBuffer).then(function(e){r(l(e))})["catch"](function(e){t(e)})})}Object.defineProperty(e,"__esModule",{value:!0}),e.songFromMIDIFileSync=l,e.songFromMIDIFile=d;var p=c(r),v=960});
},{"./fetch_helpers":6,"./midi_event":12,"./midifile":15,"./part":19,"./song":32,"./track":35,"./util":36,"isomorphic-fetch":2}],35:[function(require,module,exports){
!function(t,e){if("function"==typeof define&&define.amd)define(["exports","./part","./midi_event","./midi_note","./init_midi","./util","./init_audio","./qambi","./eventlistener"],e);else if("undefined"!=typeof exports)e(exports,require("./part"),require("./midi_event"),require("./midi_note"),require("./init_midi"),require("./util"),require("./init_audio"),require("./qambi"),require("./eventlistener"));else{var n={exports:{}};e(n.exports,t.part,t.midi_event,t.midi_note,t.init_midi,t.util,t.init_audio,t.qambi,t.eventlistener),t.track=n.exports}}(this,function(t,e,n,i,s,r,o,u,a){"use strict";function c(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}function h(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.Track=void 0;var d=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),f=1e-17,l=0;t.Track=function(){function t(){var e=arguments.length<=0||void 0===arguments[0]?null:arguments[0];h(this,t),this.id=this.constructor.name+"_"+l++ +"_"+(new Date).getTime(),this.name=e||this.id,this.channel=0,this.muted=!1,this.volume=.5,this._panner=o.context.createPanner(),this._panner.panningModel="equalpower",this._panner.setPosition(f,f,f),this._output=o.context.createGain(),this._output.gain.value=this.volume,this._panner.connect(this._output),this._midiInputs=new Map,this._midiOutputs=new Map,this._song=null,this._parts=[],this._partsById=new Map,this._events=[],this._eventsById=new Map,this._needsUpdate=!1,this._createEventArray=!1,this.latency=100,this._instrument=null,this._tmpRecordedNotes=new Map,this._recordedEvents=[],this.scheduledSamples=new Map,this.sustainedSamples=[],this.sustainPedalDown=!1,this.monitor=!1,this._songInput=null,this._effects=[]}return d(t,[{key:"setInstrument",value:function(){var t=arguments.length<=0||void 0===arguments[0]?null:arguments[0];null!==t&&"function"==typeof t.connect&&"function"==typeof t.disconnect&&"function"==typeof t.processMIDIEvent&&"function"==typeof t.allNotesOff&&"function"==typeof t.unschedule?(this.removeInstrument(),this._instrument=t,this._instrument.connect(this._panner)):null===t?this.removeInstrument():console.log('Invalid instrument, and instrument should have the methods "connect", "disconnect", "processMIDIEvent", "unschedule" and "allNotesOff"')}},{key:"removeInstrument",value:function(){null!==this._instrument&&(this._instrument.allNotesOff(),this._instrument.disconnect(),this._instrument=null)}},{key:"getInstrument",value:function(){return this._instrument}},{key:"connectMIDIOutputs",value:function(){for(var t=this,e=arguments.length,n=Array(e),i=0;e>i;i++)n[i]=arguments[i];n.forEach(function(e){"string"==typeof e&&(e=(0,s.getMIDIOutputById)(e)),e instanceof MIDIOutput&&t._midiOutputs.set(e.id,e)})}},{key:"disconnectMIDIOutputs",value:function(){for(var t=this,e=arguments.length,n=Array(e),i=0;e>i;i++)n[i]=arguments[i];0===n.length&&this._midiOutputs.clear(),n.forEach(function(e){e instanceof MIDIOutput&&(e=e.id),t._midiOutputs.has(e)&&t._midiOutputs["delete"](e)})}},{key:"connectMIDIInputs",value:function(){for(var t=this,e=arguments.length,i=Array(e),r=0;e>r;r++)i[r]=arguments[r];i.forEach(function(e){"string"==typeof e&&(e=(0,s.getMIDIInputById)(e)),e instanceof MIDIInput&&(t._midiInputs.set(e.id,e),e.onmidimessage=function(e){t.monitor===!0&&t._preprocessMIDIEvent(new(Function.prototype.bind.apply(n.MIDIEvent,[null].concat([t._song._ticks],c(e.data)))))})})}},{key:"disconnectMIDIInputs",value:function(){for(var t=this,e=arguments.length,n=Array(e),i=0;e>i;i++)n[i]=arguments[i];return 0===n.length?(this._midiInputs.forEach(function(t){t.onmidimessage=null}),void this._midiInputs.clear()):void n.forEach(function(e){e instanceof MIDIInput&&(e=e.id),t._midiInputs.has(e)&&(t._midiInputs.get(e).onmidimessage=null,t._midiInputs["delete"](e))})}},{key:"getMIDIInputs",value:function(){return Array.from(this._midiInputs.values())}},{key:"getMIDIOutputs",value:function(){return Array.from(this._midiOutputs.values())}},{key:"setRecordEnabled",value:function(t){this._recordEnabled=t}},{key:"_startRecording",value:function(t){"midi"===this._recordEnabled&&(this._recordId=t,this._recordedEvents=[],this._recordPart=new e.Part(this._recordId))}},{key:"_stopRecording",value:function(t){var e;this._recordId===t&&0!==this._recordedEvents.length&&((e=this._recordPart).addEvents.apply(e,c(this._recordedEvents)),this.addParts(this._recordPart))}},{key:"undoRecording",value:function(t){this._recordId===t&&this.removeParts(this._recordPart)}},{key:"redoRecording",value:function(t){this._recordId===t&&this.addParts(this._recordPart)}},{key:"copy",value:function(){var e=new t(this.name+"_copy"),n=[];return this._parts.forEach(function(t){var e=t.copy();console.log(e),n.push(e)}),e.addParts.apply(e,n),e.update(),e}},{key:"transpose",value:function(t){this._events.forEach(function(e){e.transpose(t)})}},{key:"addParts",value:function(){for(var t=this,e=this._song,n=arguments.length,i=Array(n),s=0;n>s;s++)i[s]=arguments[s];i.forEach(function(n){var i;n._track=t,t._parts.push(n),t._partsById.set(n.id,n);var s=n._events;if((i=t._events).push.apply(i,c(s)),e){var r;n._song=e,e._newParts.push(n),(r=e._newEvents).push.apply(r,c(s))}s.forEach(function(n){n._track=t,e&&(n._song=e),t._eventsById.set(n.id,n)})}),this._needsUpdate=!0}},{key:"removeParts",value:function(){for(var t=this,e=this._song,n=arguments.length,i=Array(n),s=0;n>s;s++)i[s]=arguments[s];i.forEach(function(n){n._track=null,t._partsById["delete"](n.id,n);var i=n._events;if(e){var s;e._removedParts.push(n),(s=e._removedEvents).push.apply(s,c(i))}i.forEach(function(n){n._track=null,e&&(n._song=null),t._eventsById["delete"](n.id,n)})}),this._needsUpdate=!0,this._createEventArray=!0}},{key:"getParts",value:function(){return this._needsUpdate&&(this._parts=Array.from(this._partsById.values()),this._events=Array.from(this._eventsById.values()),this._needsUpdate=!1),[].concat(c(this._parts))}},{key:"transposeParts",value:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),i=1;e>i;i++)n[i-1]=arguments[i];n.forEach(function(e){e.transpose(t)})}},{key:"moveParts",value:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),i=1;e>i;i++)n[i-1]=arguments[i];n.forEach(function(e){e.move(t)})}},{key:"movePartsTo",value:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),i=1;e>i;i++)n[i-1]=arguments[i];n.forEach(function(e){e.moveTo(t)})}},{key:"removeEvents",value:function(){for(var t=this,e=new Set,n=arguments.length,i=Array(n),s=0;n>s;s++)i[s]=arguments[s];if(i.forEach(function(n){e.set(n._part),n._part=null,n._track=null,n._song=null,t._eventsById["delete"](n.id)}),this._song){var r,o;(r=this._song._removedEvents).push.apply(r,i),(o=this._song._changedParts).push.apply(o,c(Array.from(e.entries())))}this._needsUpdate=!0,this._createEventArray=!0}},{key:"moveEvents",value:function(t){for(var e=new Set,n=arguments.length,i=Array(n>1?n-1:0),s=1;n>s;s++)i[s-1]=arguments[s];if(i.forEach(function(n){n.move(t),e.set(n.part)}),this._song){var r,o;(r=this._song._movedEvents).push.apply(r,i),(o=this._song._changedParts).push.apply(o,c(Array.from(e.entries())))}}},{key:"moveEventsTo",value:function(t){for(var e=new Set,n=arguments.length,i=Array(n>1?n-1:0),s=1;n>s;s++)i[s-1]=arguments[s];if(i.forEach(function(n){n.moveTo(t),e.set(n.part)}),this._song){var r,o;(r=this._song._movedEvents).push.apply(r,i),(o=this._song._changedParts).push.apply(o,c(Array.from(e.entries())))}}},{key:"getEvents",value:function(){arguments.length<=0||void 0===arguments[0]?null:arguments[0];return this._needsUpdate&&this.update(),[].concat(c(this._events))}},{key:"mute",value:function(){var t=arguments.length<=0||void 0===arguments[0]?null:arguments[0];t?this._muted=t:this._muted=!this._muted}},{key:"update",value:function(){this._createEventArray&&(this._events=Array.from(this._eventsById.values()),this._createEventArray=!1),(0,r.sortEvents)(this._events),this._needsUpdate=!1}},{key:"connect",value:function(t){this._songOutput=t,this._output.connect(this._songOutput)}},{key:"disconnect",value:function(){this._output.disconnect(this._songOutput),this._songOutput=null}},{key:"_checkEffect",value:function(t){return"function"!=typeof t.setInput||"function"!=typeof t.setOutput||"function"!=typeof t.getOutput||"function"!=typeof t.disconnect?(console.log('Invalid channel fx, and channel fx should have the methods "setInput", "setOutput", "getOutput" and "disconnect"'),!1):!0}},{key:"addEffect",value:function(t){if(this._checkEffect(t)!==!1){var e=this._effects.length,n=void 0,i=void 0;0===e?(n=this._output,n.disconnect(this._songOutput),i=this._output):(n=this._effects[e-1],n.disconnect(),i=n.getOutput()),t.setInput(i),t.setOutput(this._songOutput),this._effects.push(t)}}},{key:"addEffectAt",value:function(t,e){this._checkEffect(t)!==!1&&this._effects.splice(e,0,t)}},{key:"removeEffect",value:function(t){var e=this;if(!isNaN(t)){this._effects.forEach(function(t){t.disconnect()}),this._effects.splice(t,1);var n=this._effects.length;if(0===n)return void this._output.connect(this._songOutput);var i=this._output;this._effects.forEach(function(t,s){t.setInput(i),s===n-1?t.setOutput(e._songOutput):t.setOutput(e._effects[s+1]),i=t})}}},{key:"getEffects",value:function(){return this._effects}},{key:"getEffectAt",value:function(t){return isNaN(t)?null:this._effects[t]}},{key:"_preprocessMIDIEvent",value:function(t){t.time=0,t.recordMillis=1e3*o.context.currentTime;var e=void 0;if(t.type===u.MIDIEventTypes.NOTE_ON)e=new i.MIDINote(t),this._tmpRecordedNotes.set(t.data1,e),(0,a.dispatchEvent)({type:"noteOn",data:t});else if(t.type===u.MIDIEventTypes.NOTE_OFF){if(e=this._tmpRecordedNotes.get(t.data1),"undefined"==typeof e)return;e.addNoteOff(t),this._tmpRecordedNotes["delete"](t.data1),(0,a.dispatchEvent)({type:"noteOff",data:t})}"midi"===this._recordEnabled&&this._song.recording===!0&&this._recordedEvents.push(t),this.processMIDIEvent(t)}},{key:"processMIDIEvent",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?!1:arguments[1];return"undefined"==typeof t.time?void this._preprocessMIDIEvent(t):(null!==this._instrument&&this._instrument.processMIDIEvent(t,t.time/1e3),void this._sendToExternalMIDIOutputs(t,e))}},{key:"_sendToExternalMIDIOutputs",value:function(t,e){var n=e?this.latency:0,i=!0,s=!1,r=void 0;try{for(var o,u=this._midiOutputs.values()[Symbol.iterator]();!(i=(o=u.next()).done);i=!0){var a=o.value;a&&(128===t.type||144===t.type||176===t.type?a.send([t.type+this.channel,t.data1,t.data2],t.time+n):192!==t.type&&224!==t.type||a.send([t.type+this.channel,t.data1],t.time+n))}}catch(c){s=!0,r=c}finally{try{!i&&u["return"]&&u["return"]()}finally{if(s)throw r}}}},{key:"unschedule",value:function(t){if(null!==this._instrument&&this._instrument.unschedule(t),0!==this._midiOutputs.size&&144===t.type){var e=t.midiNote,i=new n.MIDIEvent(0,128,t.data1,0);i.midiNoteId=e.id,i.time=o.context.currentTime,this._sendToExternalMIDIOutputs(i,!0)}}},{key:"allNotesOff",value:function(){null!==this._instrument&&this._instrument.allNotesOff()}},{key:"setPanning",value:function(t){if(-1>t||t>1)return void console.log("Track.setPanning() accepts a value between -1 (full left) and 1 (full right), you entered:",t);var e=t,n=0,i=1-Math.abs(e);e=0===e?f:e,n=0===n?f:n,i=0===i?f:i,this._panner.setPosition(e,n,i),this._panningValue=t}},{key:"getPanning",value:function(){return this._panningValue}}]),t}()});
},{"./eventlistener":5,"./init_audio":8,"./init_midi":9,"./midi_event":12,"./midi_note":13,"./part":19,"./qambi":22,"./util":36}],36:[function(require,module,exports){
!function(e,t){if("function"==typeof define&&define.amd)define(["exports","isomorphic-fetch"],t);else if("undefined"!=typeof exports)t(exports,require("isomorphic-fetch"));else{var o={exports:{}};t(o.exports,e.isomorphicFetch),e.util=o.exports}}(this,function(e,t){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function n(e){var t=void 0,o=void 0,n=void 0,r=void 0,i=void 0,f="";return i=e/1e3,t=l(i/3600),o=l(i%3600/60),n=l(i%60),r=v(1e3*(i-3600*t-60*o-n)),f+=t+":",f+=10>o?"0"+o:o,f+=":",f+=10>n?"0"+n:n,f+=":",f+=0===r?"000":10>r?"00"+r:100>r?"0"+r:r,{hour:t,minute:o,second:n,millisecond:r,timeAsString:f,timeAsArray:[t,o,n,r]}}function r(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",o=void 0,n=void 0,r=void 0,i=void 0,f=void 0,c=void 0,a=void 0,d=void 0,u=void 0,s=void 0,v=void 0,l=void 0,p=void 0,h=0;for(o=Math.ceil(3*e.length/4),r=new ArrayBuffer(o),n=new Uint8Array(r),i=t.indexOf(e.charAt(e.length-1)),f=t.indexOf(e.charAt(e.length-1)),64==i&&o--,64==f&&o--,e=e.replace(/[^A-Za-z0-9\+\/\=]/g,""),p=0;o>p;p+=3)u=t.indexOf(e.charAt(h++)),s=t.indexOf(e.charAt(h++)),v=t.indexOf(e.charAt(h++)),l=t.indexOf(e.charAt(h++)),c=u<<2|s>>4,a=(15&s)<<4|v>>2,d=(3&v)<<6|l,n[p]=c,64!=v&&(n[p+1]=a),64!=l&&(n[p+2]=d);return r}function i(e){if("object"!=("undefined"==typeof e?"undefined":u(e)))return"undefined"==typeof e?"undefined":u(e);if(null===e)return"null";var t=Object.prototype.toString.call(e).match(/\[object\s(\w+)\]/)[1];return t.toLowerCase()}function f(e){e.sort(function(e,t){if(e.ticks===t.ticks){var o=e.type-t.type;return 176===e.type&&144===t.type&&(o=-1),o}return e.ticks-t.ticks})}function c(e){var t=!0;try{atob(e)}catch(o){t=!1}return t}function a(e,t,o){var n=void 0,r=void 0,i=void 0,f=new Float32Array(e);for(n=0;e>n;n++)i=n/e,"fadeIn"===t?r=Math.cos(.5*(1-i)*s)*o:"fadeOut"===t&&(r=Math.cos(.5*i*Math.PI)*o),f[n]=r,n===e-1&&(f[n]="fadeIn"===t?1:0);return f}function d(e){return isNaN(e)?(console.warn("please provide a number"),!1):0>e||e>127?(console.warn("please provide a number between 0 and 127"),!1):e}Object.defineProperty(e,"__esModule",{value:!0}),e.getNiceTime=n,e.base64ToBinary=r,e.typeString=i,e.sortEvents=f,e.checkIfBase64=c,e.getEqualPowerCurve=a,e.checkMIDINumber=d;var u=(o(t),"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}),s=Math.PI,v=(Math.pow,Math.round),l=Math.floor;Math.random});
},{"isomorphic-fetch":2}]},{},[22])(22)
});

